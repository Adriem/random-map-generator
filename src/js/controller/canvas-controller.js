var CanvasController, Color, wall;

Color = {
  GRID: "#211",
  BACKGROUND: "#fff",
  WALL: "#200",
  GROUND: "#622",
  DOOR: "#400",
  DOOR: "#844",
  DEBUG: "#0F0",
  START_POINT: "#450"
};

wall = ['NONE', 'TILE', 'COMPOSED'];

CanvasController = (function() {
  function CanvasController(id) {
    this.id = id;
    this.canvas = $('#' + this.id)[0].getContext("2d");
  }

  CanvasController.prototype.getWidth = function() {
    return parseInt($('#' + this.id).attr("width"));
  };

  CanvasController.prototype.calculateTileSize = function(numberOfTiles) {
    return Math.floor(this.getWidth() / numberOfTiles);
  };

  CanvasController.prototype.calculateGridWidth = function(tileSize) {
    return Math.floor(tileSize / 10);
  };

  CanvasController.prototype.calculateWallSize = function(tileSize) {
    return Math.floor(tileSize / 3);
  };

  CanvasController.prototype.drawMap = function(tilemap, drawGrid, showWalls) {
    var i, j, ref, ref1, tileSize, x, y;
    if (drawGrid == null) {
      drawGrid = true;
    }
    if (showWalls == null) {
      showWalls = true;
    }
    tileSize = this.calculateTileSize(tilemap.width);
    this.canvas.fillStyle = Color.BACKGROUND;
    this.canvas.fillRect(0, 0, this.getWidth(), this.getWidth());
    for (y = i = 0, ref = tilemap.height; 0 <= ref ? i < ref : i > ref; y = 0 <= ref ? ++i : --i) {
      for (x = j = 0, ref1 = tilemap.width; 0 <= ref1 ? j < ref1 : j > ref1; x = 0 <= ref1 ? ++j : --j) {
        switch (tilemap[x][y]) {
          case Tile.FIRST_ROOM:
            this.drawTile(x, y, tileSize, Color.START_POINT);
            break;
          case Tile.GROUND:
            this.drawTile(x, y, tileSize, Color.GROUND);
            break;
          case Tile.WALL:
            if (wall[showWalls] === 'TILE') {
              this.drawTile(x, y, tileSize, Color.WALL);
            } else if (wall[showWalls] === 'COMPOSED') {
              this.drawWall(x, y, tileSize, Color.WALL, tilemap);
            }
            break;
          case Tile.DOOR:
            this.drawTile(x, y, tileSize, Color.DOOR);
        }
      }
    }
    if (drawGrid) {
      return this.drawGrid(tilemap);
    }
  };

  CanvasController.prototype.drawTile = function(x, y, size, value) {
    this.canvas.fillStyle = value;
    return this.canvas.fillRect(x * size, y * size, size, size);
  };

  CanvasController.prototype.drawWall = function(x, y, size, value, tilemap) {
    var flags, wallSize;
    flags = {
      north: !tilemap.is(x, y - 1, 1, 1, Tile.EMPTY) && !tilemap.is(x, y - 1, 1, 1, Tile.WALL) && y > 1,
      south: !tilemap.is(x, y + 1, 1, 1, Tile.EMPTY) && !tilemap.is(x, y + 1, 1, 1, Tile.WALL) && y < tilemap.height - 1,
      east: !tilemap.is(x + 1, y, 1, 1, Tile.EMPTY) && !tilemap.is(x + 1, y, 1, 1, Tile.WALL) && x < tilemap.width - 1,
      west: !tilemap.is(x - 1, y, 1, 1, Tile.EMPTY) && !tilemap.is(x - 1, y, 1, 1, Tile.WALL) && x > 1,
      northwest: !tilemap.is(x - 1, y - 1, 1, 1, Tile.EMPTY) && !tilemap.is(x - 1, y - 1, 1, 1, Tile.WALL) && y > 1 && x > 1,
      northeast: !tilemap.is(x + 1, y - 1, 1, 1, Tile.EMPTY) && !tilemap.is(x + 1, y - 1, 1, 1, Tile.WALL) && y > 1 && x < tilemap.width - 1,
      southwest: !tilemap.is(x - 1, y + 1, 1, 1, Tile.EMPTY) && !tilemap.is(x - 1, y + 1, 1, 1, Tile.WALL) && y < tilemap.height - 1 && x > 1,
      southeast: !tilemap.is(x + 1, y + 1, 1, 1, Tile.EMPTY) && !tilemap.is(x + 1, y + 1, 1, 1, Tile.WALL) && y < tilemap.height - 1 && x < tilemap.width - 1
    };
    wallSize = this.calculateWallSize(size);
    this.canvas.fillStyle = value;
    if (flags.north) {
      this.canvas.fillRect(x * size, y * size, size, wallSize);
    }
    if (flags.south) {
      this.canvas.fillRect(x * size, (y + 1) * size - wallSize, size, wallSize);
    }
    if (flags.east) {
      this.canvas.fillRect((x + 1) * size - wallSize, y * size, wallSize, size);
    }
    if (flags.west) {
      this.canvas.fillRect(x * size, y * size, wallSize, size);
    }
    if (flags.northwest) {
      this.canvas.fillRect(x * size, y * size, wallSize, wallSize);
    }
    if (flags.northeast) {
      this.canvas.fillRect((x + 1) * size - wallSize, y * size, wallSize, wallSize);
    }
    if (flags.southeast) {
      this.canvas.fillRect((x + 1) * size - wallSize, (y + 1) * size - wallSize, wallSize, wallSize);
    }
    if (flags.southwest) {
      return this.canvas.fillRect(x * size, (y + 1) * size - wallSize, wallSize, wallSize);
    }
  };

  CanvasController.prototype.drawGrid = function(tilemap) {
    var i, ref, tileSize, x;
    tileSize = this.calculateTileSize(tilemap.width);
    this.canvas.beginPath();
    this.canvas.strokeStyle = Color.GRID;
    for (x = i = 0, ref = tilemap.width; 0 <= ref ? i <= ref : i >= ref; x = 0 <= ref ? ++i : --i) {
      this.canvas.moveTo(x * tileSize, 0);
      this.canvas.lineTo(x * tileSize, tilemap.width * tileSize);
      this.canvas.moveTo(0, x * tileSize);
      this.canvas.lineTo(tilemap.width * tileSize, x * tileSize);
    }
    this.canvas.lineWidth = this.calculateGridWidth(tileSize);
    this.canvas.stroke();
    return this.canvas.closePath();
  };

  return CanvasController;

})();

this.CanvasController = CanvasController;

this.wallStyle = wall;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRyb2xsZXIvY2FudmFzLWNvbnRyb2xsZXIuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLElBQUE7O0FBQUEsS0FBQSxHQUNFO0VBQUEsSUFBQSxFQUFNLE1BQU47RUFDQSxVQUFBLEVBQVksTUFEWjtFQUtBLElBQUEsRUFBTSxNQUxOO0VBTUEsTUFBQSxFQUFRLE1BTlI7RUFPQSxJQUFBLEVBQU0sTUFQTjtFQVFBLElBQUEsRUFBTSxNQVJOO0VBU0EsS0FBQSxFQUFPLE1BVFA7RUFhQSxXQUFBLEVBQWEsTUFiYjs7O0FBZ0JGLElBQUEsR0FBTyxDQUFDLE1BQUQsRUFBUyxNQUFULEVBQWlCLFVBQWpCOztBQUVEO0VBRVMsMEJBQUMsRUFBRDtJQUFDLElBQUMsQ0FBQSxLQUFEO0lBQVEsSUFBQyxDQUFBLE1BQUQsR0FBVSxDQUFBLENBQUUsR0FBQSxHQUFNLElBQUMsQ0FBQSxFQUFULENBQWEsQ0FBQSxDQUFBLENBQUUsQ0FBQyxVQUFoQixDQUEyQixJQUEzQjtFQUFuQjs7NkJBRWIsUUFBQSxHQUFVLFNBQUE7V0FBTSxRQUFBLENBQVMsQ0FBQSxDQUFFLEdBQUEsR0FBTSxJQUFDLENBQUEsRUFBVCxDQUFZLENBQUMsSUFBYixDQUFrQixPQUFsQixDQUFUO0VBQU47OzZCQUNWLGlCQUFBLEdBQW1CLFNBQUMsYUFBRDtzQkFBbUIsSUFBQyxDQUFBLFFBQUQsQ0FBQSxJQUFlO0VBQWxDOzs2QkFDbkIsa0JBQUEsR0FBb0IsU0FBQyxRQUFEO3NCQUFjLFdBQVk7RUFBMUI7OzZCQUNwQixpQkFBQSxHQUFtQixTQUFDLFFBQUQ7c0JBQWMsV0FBWTtFQUExQjs7NkJBRW5CLE9BQUEsR0FBUyxTQUFDLE9BQUQsRUFBVSxRQUFWLEVBQTJCLFNBQTNCO0FBQ1AsUUFBQTs7TUFEaUIsV0FBVzs7O01BQU0sWUFBWTs7SUFDOUMsUUFBQSxHQUFXLElBQUMsQ0FBQSxpQkFBRCxDQUFtQixPQUFPLENBQUMsS0FBM0I7SUFDWCxJQUFDLENBQUEsTUFB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Ozs7O0FBY1osSUFBSSxDQUFDLGdCQUFMLEdBQXdCOztBQUN4QixJQUFJLENBQUMsU0FBTCxHQUFpQiIsImZpbGUiOiJjb250cm9sbGVyL2NhbnZhcy1jb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuIyAgVGhpcyBmaWxlIGRlZmluZXMgdGhlIGNvbnRyb2xsZXIgYW5kIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBjYW52YXNcclxuIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbkNvbG9yID1cclxuICBHUklEOiBcIiMyMTFcIlxyXG4gIEJBQ0tHUk9VTkQ6IFwiI2ZmZlwiXHJcbiAgIyBXQUxMOiBcIiNhOTlcIlxyXG4gICMgV0FMTDogXCIjYTExXCJcclxuICAjIFdBTEw6IFwiI2U2MFwiXHJcbiAgV0FMTDogXCIjMjAwXCJcclxuICBHUk9VTkQ6IFwiIzYyMlwiXHJcbiAgRE9PUjogXCIjNDAwXCJcclxuICBET09SOiBcIiM4NDRcIlxyXG4gIERFQlVHOiBcIiMwRjBcIlxyXG4gICMgU1RBUlRfUE9JTlQ6IFwiIzRBM1wiXHJcbiAgIyBTVEFSVF9QT0lOVDogXCIjMTYwXCJcclxuICAjIFNUQVJUX1BPSU5UOiBcIiMxNTBcIlxyXG4gIFNUQVJUX1BPSU5UOiBcIiM0NTBcIlxyXG4gICMgU1RBUlRfUE9JTlQ6IFwiIzU0MFwiXHJcblxyXG53YWxsID0gWydOT05FJywgJ1RJTEUnLCAnQ09NUE9TRUQnXVxyXG5cclxuY2xhc3MgQ2FudmFzQ29udHJvbGxlclxyXG5cclxuICBjb25zdHJ1Y3RvcjogKEBpZCkgLT4gQGNhbnZhcyA9ICQoJyMnICsgQGlkKVswXS5nZXRDb250ZXh0KFwiMmRcIilcclxuXHJcbiAgZ2V0V2lkdGg6ICgpIC0+IHBhcnNlSW50ICQoJyMnICsgQGlkKS5hdHRyKFwid2lkdGhcIilcclxuICBjYWxjdWxhdGVUaWxlU2l6ZTogKG51bWJlck9mVGlsZXMpIC0+IEBnZXRXaWR0aCgpIC8vIG51bWJlck9mVGlsZXNcclxuICBjYWxjdWxhdGVHcmlkV2lkdGg6ICh0aWxlU2l6ZSkgLT4gdGlsZVNpemUgLy8gMTBcclxuICBjYWxjdWxhdGVXYWxsU2l6ZTogKHRpbGVTaXplKSAtPiB0aWxlU2l6ZSAvLyAzXHJcblxyXG4gIGRyYXdNYXA6ICh0aWxlbWFwLCBkcmF3R3JpZCA9IHRydWUsIHNob3dXYWxscyA9IHRydWUpIC0+XHJcbiAgICB0aWxlU2l6ZSA9IEBjYWxjdWxhdGVUaWxlU2l6ZSh0aWxlbWFwLndpZHRoKVxyXG4gICAgQGNhbnZhcy5maWxsU3R5bGUgPSBDb2xvci5CQUNLR1JPVU5EXHJcbiAgICBAY2FudmFzLmZpbGxSZWN0KDAsIDAsIEBnZXRXaWR0aCgpLCBAZ2V0V2lkdGgoKSlcclxuICAgIGZvciB5IGluIFswLi4udGlsZW1hcC5oZWlnaHRdIHRoZW4gZm9yIHggaW4gWzAuLi50aWxlbWFwLndpZHRoXVxyXG4gICAgICBzd2l0Y2ggdGlsZW1hcFt4XVt5XVxyXG4gICAgICAgIHdoZW4gVGlsZS5GSVJTVF9ST09NIHRoZW4gQGRyYXdUaWxlKHgsIHksIHRpbGVTaXplLCBDb2xvci5TVEFSVF9QT0lOVClcclxuICAgICAgICB3aGVuIFRpbGUuR1JPVU5EIHRoZW4gQGRyYXdUaWxlKHgsIHksIHRpbGVTaXplLCBDb2xvci5HUk9VTkQpXHJcbiAgICAgICAgd2hlbiBUaWxlLldBTExcclxuICAgICAgICAgIGlmIHdhbGxbc2hvd1dhbGxzXSBpcyAnVElMRSdcclxuICAgICAgICAgICAgQGRyYXdUaWxlKHgsIHksIHRpbGVTaXplLCBDb2xvci5XQUxMKVxyXG4gICAgICAgICAgZWxzZSBpZiB3YWxsW3Nob3dXYWxsc10gaXMgJ0NPTVBPU0VEJ1xyXG4gICAgICAgICAgICBAZHJhd1dhbGwoeCwgeSwgdGlsZVNpemUsIENvbG9yLldBTEwsIHRpbGVtYXApXHJcbiAgICAgICAgd2hlbiBUaWxlLkRPT1IgdGhlbiBAZHJhd1RpbGUoeCwgeSwgdGlsZVNpemUsIENvbG9yLkRPT1IpXHJcbiAgICBAZHJhd0dyaWQodGlsZW1hcCkgaWYgZHJhd0dyaWRcclxuXHJcbiAgZHJhd1RpbGU6ICh4LCB5LCBzaXplLCB2YWx1ZSkgLT5cclxuICAgIEBjYW52YXMuZmlsbFN0eWxlID0gdmFsdWVcclxuICAgIEBjYW52YXMuZmlsbFJlY3QoeCAqIHNpemUsIHkgKiBzaXplLCBzaXplLCBzaXplKVxyXG5cclxuICBkcmF3V2FsbDogKHgsIHksIHNpemUsIHZhbHVlLCB0aWxlbWFwKSAtPlxyXG4gICAgZmxhZ3MgPVxyXG4gICAgICBub3J0aDogbm90IHRpbGVtYXAuaXMoeCwgeSAtIDEsIDEsIDEsIFRpbGUuRU1QVFkpIGFuZFxyXG4gICAgICAgICAgICAgbm90IHRpbGVtYXAuaXMoeCwgeSAtIDEsIDEsIDEsIFRpbGUuV0FMTCkgYW5kIHkgPiAxXHJcbiAgICAgIHNvdXRoOiBub3QgdGlsZW1hcC5pcyh4LCB5ICsgMSwgMSwgMSwgVGlsZS5FTVBUWSkgYW5kXHJcbiAgICAgICAgICAgICBub3QgdGlsZW1hcC5pcyh4LCB5ICsgMSwgMSwgMSwgVGlsZS5XQUxMKWFuZCB5IDwgdGlsZW1hcC5oZWlnaHQgLSAxXHJcbiAgICAgIGVhc3Q6IG5vdCB0aWxlbWFwLmlzKHggKyAxLCB5LCAxLCAxLCBUaWxlLkVNUFRZKSBhbmRcclxuICAgICAgICAgICAgbm90IHRpbGVtYXAuaXMoeCArIDEsIHksIDEsIDEsIFRpbGUuV0FMTCkgYW5kIHggPCB0aWxlbWFwLndpZHRoIC0gMVxyXG4gICAgICB3ZXN0OiBub3QgdGlsZW1hcC5pcyh4IC0gMSwgeSwgMSwgMSwgVGlsZS5FTVBUWSkgYW5kXHJcbiAgICAgICAgICAgIG5vdCB0aWxlbWFwLmlzKHggLSAxLCB5LCAxLCAxLCBUaWxlLldBTEwpIGFuZCB4ID4gMVxyXG4gICAgICBub3J0aHdlc3Q6IG5vdCB0aWxlbWFwLmlzKHggLSAxLCB5IC0gMSwgMSwgMSwgVGlsZS5FTVBUWSkgYW5kXHJcbiAgICAgICAgICAgICAgICAgbm90IHRpbGVtYXAuaXMoeCAtIDEsIHkgLSAxLCAxLCAxLCBUaWxlLldBTEwpIGFuZFxyXG4gICAgICAgICAgICAgICAgIHkgPiAxIGFuZCB4ID4gMVxyXG4gICAgICBub3J0aGVhc3Q6IG5vdCB0aWxlbWFwLmlzKHggKyAxLCB5IC0gMSwgMSwgMSwgVGlsZS5FTVBUWSkgYW5kXHJcbiAgICAgICAgICAgICAgICAgbm90IHRpbGVtYXAuaXMoeCArIDEsIHkgLSAxLCAxLCAxLCBUaWxlLldBTEwpIGFuZFxyXG4gICAgICAgICAgICAgICAgIHkgPiAxIGFuZCB4IDwgdGlsZW1hcC53aWR0aCAtIDFcclxuICAgICAgc291dGh3ZXN0OiBub3QgdGlsZW1hcC5pcyh4IC0gMSwgeSArIDEsIDEsIDEsIFRpbGUuRU1QVFkpIGFuZFxyXG4gICAgICAgICAgICAgICAgIG5vdCB0aWxlbWFwLmlzKHggLSAxLCB5ICsgMSwgMSwgMSwgVGlsZS5XQUxMKSBhbmRcclxuICAgICAgICAgICAgICAgICB5IDwgdGlsZW1hcC5oZWlnaHQgLSAxIGFuZCB4ID4gMVxyXG4gICAgICBzb3V0aGVhc3Q6IG5vdCB0aWxlbWFwLmlzKHggKyAxLCB5ICsgMSwgMSwgMSwgVGlsZS5FTVBUWSkgYW5kXHJcbiAgICAgICAgICAgICAgICAgbm90IHRpbGVtYXAuaXMoeCArIDEsIHkgKyAxLCAxLCAxLCBUaWxlLldBTEwpIGFuZFxyXG4gICAgICAgICAgICAgICAgIHkgPCB0aWxlbWFwLmhlaWdodCAtIDEgYW5kIHggPCB0aWxlbWFwLndpZHRoIC0gMVxyXG4gICAgd2FsbFNpemUgPSBAY2FsY3VsYXRlV2FsbFNpemUoc2l6ZSlcclxuICAgIEBjYW52YXMuZmlsbFN0eWxlID0gdmFsdWVcclxuICAgIEBjYW52YXMuZmlsbFJlY3QoeCpzaXplLCB5KnNpemUsIHNpemUsIHdhbGxTaXplKSBpZiBmbGFncy5ub3J0aFxyXG4gICAgQGNhbnZhcy5maWxsUmVjdCh4KnNpemUsICh5KzEpKnNpemUtd2FsbFNpemUsIHNpemUsIHdhbGxTaXplKSBpZiBmbGFncy5zb3V0aFxyXG4gICAgQGNhbnZhcy5maWxsUmVjdCgoeCsxKSpzaXplLXdhbGxTaXplLCB5KnNpemUsIHdhbGxTaXplLCBzaXplKSBpZiBmbGFncy5lYXN0XHJcbiAgICBAY2FudmFzLmZpbGxSZWN0KHgqc2l6ZSwgeSpzaXplLCB3YWxsU2l6ZSwgc2l6ZSkgaWYgZmxhZ3Mud2VzdFxyXG4gICAgQGNhbnZhcy5maWxsUmVjdCh4KnNpemUsIHkqc2l6ZSwgd2FsbFNpemUsIHdhbGxTaXplKSBpZiBmbGFncy5ub3J0aHdlc3RcclxuICAgIEBjYW52YXMuZmlsbFJlY3QoKHgrMSkqc2l6ZS13YWxsU2l6ZSwgeSpzaXplLFxyXG4gICAgICAgIHdhbGxTaXplLCB3YWxsU2l6ZSkgaWYgZmxhZ3Mubm9ydGhlYXN0XHJcbiAgICBAY2FudmFzLmZpbGxSZWN0KCh4KzEpKnNpemUtd2FsbFNpemUsICh5KzEpKnNpemUtd2FsbFNpemUsXHJcbiAgICAgICAgd2FsbFNpemUsIHdhbGxTaXplKSBpZiBmbGFncy5zb3V0aGVhc3RcclxuICAgIEBjYW52YXMuZmlsbFJlY3QoeCAqIHNpemUsICh5ICsgMSkgKiBzaXplIC0gd2FsbFNpemUsXHJcbiAgICAgICAgd2FsbFNpemUsIHdhbGxTaXplKSBpZiBmbGFncy5zb3V0aHdlc3RcclxuXHJcbiAgZHJhd0dyaWQ6ICh0aWxlbWFwKSAtPlxyXG4gICAgdGlsZVNpemUgPSBAY2FsY3VsYXRlVGlsZVNpemUodGlsZW1hcC53aWR0aClcclxuICAgIEBjYW52YXMuYmVnaW5QYXRoKClcclxuICAgIEBjYW52YXMuc3Ryb2tlU3R5bGUgPSBDb2xvci5HUklEXHJcbiAgICBmb3IgeCBpbiBbMC4udGlsZW1hcC53aWR0aF0gICMgV2UgYXNzdW1lIHRpbGVtYXAgdG8gYmUgc3F1YXJlZFxyXG4gICAgICBAY2FudmFzLm1vdmVUbyh4ICogdGlsZVNpemUsIDApXHJcbiAgICAgIEBjYW52YXMubGluZVRvKHggKiB0aWxlU2l6ZSwgdGlsZW1hcC53aWR0aCAqIHRpbGVTaXplKVxyXG4gICAgICBAY2FudmFzLm1vdmVUbygwLCB4ICogdGlsZVNpemUpXHJcbiAgICAgIEBjYW52YXMubGluZVRvKHRpbGVtYXAud2lkdGggKiB0aWxlU2l6ZSwgeCAqIHRpbGVTaXplKVxyXG4gICAgQGNhbnZhcy5saW5lV2lkdGggPSBAY2FsY3VsYXRlR3JpZFdpZHRoKHRpbGVTaXplKVxyXG4gICAgQGNhbnZhcy5zdHJva2UoKVxyXG4gICAgQGNhbnZhcy5jbG9zZVBhdGgoKVxyXG5cclxuIyBNYWtlIENhbnZhc0NvbnRyb2xsZXIgYXZhaWxhYmxlIGdsb2JhbGx5XHJcbnRoaXMuQ2FudmFzQ29udHJvbGxlciA9IENhbnZhc0NvbnRyb2xsZXJcclxudGhpcy53YWxsU3R5bGUgPSB3YWxsXHJcbiJdfQ==