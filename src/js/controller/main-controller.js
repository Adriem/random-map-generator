var hasProp = {}.hasOwnProperty;

$(document).ready(function() {
  var canvas, controls, drawMap, drawStepByStep, drawing, generateMap, key, map, properties, value;
  drawing = false;
  canvas = new CanvasController('canvas');
  map = null;
  properties = {
    tilesPerUnit: new NumericInput('tilesPerUnit', 'Tiles per unit', 1),
    wallStyle: new SelectInput('wallStyle', "Wall style", wallStyle),
    drawGrid: new ToggleInput('drawGrid', "Draw grid")
  };
  controls = {
    mapSize: new NumericInput('mapSize', 'Map size (units)', 5),
    numberOfRooms: new NumericInput('numberOfRooms', 'Number of rooms', 1),
    initialRoomW: new NumericInput('initialRoomW', 'Initial room width', 1),
    initialRoomH: new NumericInput('initialRoomH', 'Initial room height', 1),
    minRoomSize: new NumericInput('minRoomSize', 'Min. room size', 1),
    maxRoomSize: new NumericInput('maxRoomSize', 'Max. room size', 1),
    minArea: new ToggleableNumericInput('minArea', 'Min. room area', 1),
    maxArea: new ToggleableNumericInput('maxArea', 'Max. room area', 1),
    ratioRestr: new ToggleableNumericInput('ratioRestr', 'Ratio restr.', 0.5, 1, 0.1)
  };
  generateMap = function() {
    var steps;
    steps = [];
    map = generate(controls.numberOfRooms.get(), {
      width: controls.mapSize.get(),
      height: controls.mapSize.get(),
      initialRoomWidth: controls.initialRoomW.get(),
      initialRoomHeight: controls.initialRoomH.get(),
      minRoomSize: controls.minRoomSize.get(),
      maxRoomSize: controls.maxRoomSize.get(),
      ratioRestriction: controls.ratioRestr.getToggleState() ? controls.ratioRestr.getValue() : void 0,
      maxRoomArea: controls.maxArea.getToggleState() ? controls.maxArea.getValue() : void 0,
      minRoomArea: controls.minArea.getToggleState() ? controls.minArea.getValue() : void 0
    }, function(map, step) {
      console.log("Step #" + step + ": ", map.roomList);
      return steps.push(map);
    });
    return drawStepByStep(canvas, steps);
  };
  drawMap = function(canvas, map) {
    var j, len, ref, room, tilemap;
    $('#room-list').empty();
    ref = map.roomList;
    for (j = 0, len = ref.length; j < len; j++) {
      room = ref[j];
      $('#room-list').append("<div><strong>Room #" + room.id + ": </strong> {\n  x: " + room.x + ", y: " + room.y + ", width: " + room.width + ", height: " + room.height + "\n}</div>");
    }
    tilemap = map.getTilemap(properties.tilesPerUnit.get());
    return canvas.drawMap(tilemap, properties.drawGrid.get(), properties.wallStyle.get());
  };
  drawStepByStep = function(canvas, steps, i) {
    if (i == null) {
      i = 0;
    }
    $('#generate').attr('disabled', '');
    drawing = true;
    drawMap(canvas, steps.shift());
    if (steps.length > 0) {
      return setTimeout((function() {
        return drawStepByStep(canvas, steps);
      }), 250);
    } else {
      $('#generate').removeAttr('disabled', '');
      return drawing = false;
    }
  };
  for (key in properties) {
    if (!hasProp.call(properties, key)) continue;
    value = properties[key];
    $('#renderer-controls').append(value.html);
  }
  for (key in controls) {
    if (!hasProp.call(controls, key)) continue;
    value = controls[key];
    $('#generator-controls').append(value.html);
  }
  $("#generate").click(generateMap);
  $('[data-togle="tooltip"]').tooltip();
  controls.mapSize.set(Defaults.MAP_SIZE);
  controls.numberOfRooms.set(Defaults.NUMBER_OF_ROOMS);
  controls.initialRoomW.set(Defaults.INITIAL_ROOM_WIDTH);
  controls.initialRoomH.set(Defaults.INITIAL_ROOM_HEIGHT);
  controls.minRoomSize.set(Defaults.MIN_ROOM_SIZE);
  controls.maxRoomSize.set(Defaults.MAX_ROOM_SIZE);
  controls.minArea.set(Defaults.MIN_ROOM_AREA);
  controls.minArea.toggle(true);
  controls.maxArea.set(Defaults.MAX_ROOM_AREA);
  controls.maxArea.toggle(false);
  controls.ratioRestr.set(Defaults.RATIO_RESTRICTION);
  controls.ratioRestr.toggle(false);
  properties.tilesPerUnit.set(Defaults.TILES_PER_UNIT);
  properties.wallStyle.set(2);
  properties.drawGrid.set(true);
  properties.tilesPerUnit.setListener(function() {
    if (!drawing) {
      return drawMap(canvas, map);
    }
  });
  properties.wallStyle.setListener(function() {
    if (!drawing) {
      return drawMap(canvas, map);
    }
  });
  properties.drawGrid.setListener(function() {
    if (!drawing) {
      return drawMap(canvas, map);
    }
  });
  controls.maxArea.setToggleListener(function() {
    return controls.maxArea.toggle(controls.maxArea.getToggleState());
  });
  controls.minArea.setToggleListener(function() {
    return controls.minArea.toggle(controls.minArea.getToggleState());
  });
  controls.ratioRestr.setToggleListener(function() {
    return controls.ratioRestr.toggle(controls.ratioRestr.getToggleState());
  });
  return generateMap();
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRyb2xsZXIvbWFpbi1jb250cm9sbGVyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztBQUFBLENBQUEsQ0FBRSxRQUFGLENBQVcsQ0FBQyxLQUFaLENBQWtCLFNBQUE7QUFFaEIsTUFBQTtFQUFBLE9BQUEsR0FBVTtFQUNWLE1BQUEsR0FBYSxJQUFBLGdCQUFBLENBQWlCLFFBQWpCO0VBQ2IsR0FBQSxHQUFNO0VBR04sVUFBQSxHQUNFO0lBQUEsWUFBQSxFQUFtQixJQUFBLFlBQUEsQ0FBYSxjQUFiLEVBQTZCLGdCQUE3QixFQUErQyxDQUEvQyxDQUFuQjtJQUNBLFNBQUEsRUFBbUIsSUFBQSxXQUFBLENBQVksV0FBWixFQUF5QixZQUF6QixFQUF1QyxTQUF2QyxDQURuQjtJQUVBLFFBQUEsRUFBbUIsSUFBQSxXQUFBLENBQVksVUFBWixFQUF3QixXQUF4QixDQUZuQjs7RUFNRixRQUFBLEdBQ0U7SUFBQSxPQUFBLEVBQW9CLElBQUEsWUFBQSxDQUFhLFNBQWIsRUFBd0Isa0JBQXhCLEVBQTRDLENBQTVDLENBQXBCO0lBQ0EsYUFBQSxFQUFvQixJQUFBLFlBQUEsQ0FBYSxlQUFiLEVBQThCLGlCQUE5QixFQUFpRCxDQUFqRCxDQURwQjtJQUVBLFlBQUEsRUFBb0IsSUFBQSxZQUFBLENBQWEsY0FBYixFQUE2QixvQkFBN0IsRUFBbUQsQ0FBbkQsQ0FGcEI7SUFHQSxZQUFBLEVBQW9CLElBQUEsWUFBQSxDQUFhLGNBQWIsRUFBNkIscUJBQTdCLEVBQW9ELENBQXBELENBSHBCO0lBSUEsV0FBQSxFQUFvQixJQUFBLFlBQUEsQ0FBYSxhQUFiLEVBQTRCLGdCQUE1QixFQUE4QyxDQUE5QyxDQUpwQjtJQUtBLFdBQUEsRUFBb0IsSUFBQSxZQUFBLENBQWEsYUFBYixFQUE0QixnQkFBNUIsRUFBOEMsQ0FBOUMsQ0FMcEI7SUFNQSxPQUFBLEVBQWEsSUFBQSxzQkFBQSxDQUF1QixTQUF2QixFQUFrQyxnQkFBbEMsRUFBb0QsQ0FB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aUMsQ0FBbkM7RUFFQSxRQUFRLENBQUMsVUFBVSxDQUFDLGlCQUFwQixDQUFzQyxTQUFBO1dBQ3BDLFFBQVEsQ0FBQyxVQUFVLENBQUMsTUFBcEIsQ0FBMkIsUUFBUSxDQUFDLFVBQVUsQ0FBQyxjQUFwQixDQUFBLENBQTNCO0VBRG9DLENBQXRDO1NBSUEsV0FBQSxDQUFBO0FBdkhnQixDQUFsQiIsImZpbGUiOiJjb250cm9sbGVyL21haW4tY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIiQoZG9jdW1lbnQpLnJlYWR5ICgpIC0+XHJcblxyXG4gIGRyYXdpbmcgPSBmYWxzZVxyXG4gIGNhbnZhcyA9IG5ldyBDYW52YXNDb250cm9sbGVyICdjYW52YXMnXHJcbiAgbWFwID0gbnVsbFxyXG5cclxuICAjIFJFTkRFUkVSIFBST1BFUlRJRVNcclxuICBwcm9wZXJ0aWVzID1cclxuICAgIHRpbGVzUGVyVW5pdCA6IG5ldyBOdW1lcmljSW5wdXQoJ3RpbGVzUGVyVW5pdCcsICdUaWxlcyBwZXIgdW5pdCcsIDEpXHJcbiAgICB3YWxsU3R5bGUgICAgOiBuZXcgU2VsZWN0SW5wdXQoJ3dhbGxTdHlsZScsIFwiV2FsbCBzdHlsZVwiLCB3YWxsU3R5bGUpXHJcbiAgICBkcmF3R3JpZCAgICAgOiBuZXcgVG9nZ2xlSW5wdXQoJ2RyYXdHcmlkJywgXCJEcmF3IGdyaWRcIilcclxuICAgICMgZGVidWdNb2RlICAgIDogbmV3IFRvZ2dsZUlucHV0KCdkZWJ1Z01vZGUnLCBcIlNob3cgZGVidWcgaW5mb1wiLCB0cnVlKVxyXG5cclxuICAjIEdFTkVSQVRPUiBDT05UUk9MU1xyXG4gIGNvbnRyb2xzID1cclxuICAgIG1hcFNpemUgICAgICAgOiBuZXcgTnVtZXJpY0lucHV0KCdtYXBTaXplJywgJ01hcCBzaXplICh1bml0cyknLCA1KVxyXG4gICAgbnVtYmVyT2ZSb29tcyA6IG5ldyBOdW1lcmljSW5wdXQoJ251bWJlck9mUm9vbXMnLCAnTnVtYmVyIG9mIHJvb21zJywgMSlcclxuICAgIGluaXRpYWxSb29tVyAgOiBuZXcgTnVtZXJpY0lucHV0KCdpbml0aWFsUm9vbVcnLCAnSW5pdGlhbCByb29tIHdpZHRoJywgMSlcclxuICAgIGluaXRpYWxSb29tSCAgOiBuZXcgTnVtZXJpY0lucHV0KCdpbml0aWFsUm9vbUgnLCAnSW5pdGlhbCByb29tIGhlaWdodCcsIDEpXHJcbiAgICBtaW5Sb29tU2l6ZSAgIDogbmV3IE51bWVyaWNJbnB1dCgnbWluUm9vbVNpemUnLCAnTWluLiByb29tIHNpemUnLCAxKVxyXG4gICAgbWF4Um9vbVNpemUgICA6IG5ldyBOdW1lcmljSW5wdXQoJ21heFJvb21TaXplJywgJ01heC4gcm9vbSBzaXplJywgMSlcclxuICAgIG1pbkFyZWE6IG5ldyBUb2dnbGVhYmxlTnVtZXJpY0lucHV0KCdtaW5BcmVhJywgJ01pbi4gcm9vbSBhcmVhJywgMSlcclxuICAgIG1heEFyZWE6IG5ldyBUb2dnbGVhYmxlTnVtZXJpY0lucHV0KCdtYXhBcmVhJywgJ01heC4gcm9vbSBhcmVhJywgMSlcclxuICAgIHJhdGlvUmVzdHI6IG5ldyBUb2dnbGVhYmxlTnVtZXJpY0lucHV0KCdyYXRpb1Jlc3RyJywgJ1JhdGlvIHJlc3RyLicsIDAuNSwgMSwgMC4xKVxyXG5cclxuICAjIEZVTkNUSU9OIERFRklOSVRJT05cclxuICBnZW5lcmF0ZU1hcCA9ICgpIC0+XHJcbiAgICBzdGVwcyA9IFtdXHJcbiAgICBtYXAgPSBnZW5lcmF0ZShcclxuICAgICAgY29udHJvbHMubnVtYmVyT2ZSb29tcy5nZXQoKSxcclxuICAgICAge1xyXG4gICAgICAgIHdpZHRoOiBjb250cm9scy5tYXBTaXplLmdldCgpXHJcbiAgICAgICAgaGVpZ2h0OiBjb250cm9scy5tYXBTaXplLmdldCgpXHJcbiAgICAgICAgaW5pdGlhbFJvb21XaWR0aDogY29udHJvbHMuaW5pdGlhbFJvb21XLmdldCgpXHJcbiAgICAgICAgaW5pdGlhbFJvb21IZWlnaHQ6IGNvbnRyb2xzLmluaXRpYWxSb29tSC5nZXQoKVxyXG4gICAgICAgIG1pblJvb21TaXplOiBjb250cm9scy5taW5Sb29tU2l6ZS5nZXQoKVxyXG4gICAgICAgIG1heFJvb21TaXplOiBjb250cm9scy5tYXhSb29tU2l6ZS5nZXQoKVxyXG4gICAgICAgIHJhdGlvUmVzdHJpY3Rpb246XHJcbiAgICAgICAgICBpZiBjb250cm9scy5yYXRpb1Jlc3RyLmdldFRvZ2dsZVN0YXRlKClcclxuICAgICAgICAgICAgY29udHJvbHMucmF0aW9SZXN0ci5nZXRWYWx1ZSgpXHJcbiAgICAgICAgICBlbHNlIHVuZGVmaW5lZFxyXG4gICAgICAgIG1heFJvb21BcmVhOlxyXG4gICAgICAgICAgaWYgY29udHJvbHMubWF4QXJlYS5nZXRUb2dnbGVTdGF0ZSgpXHJcbiAgICAgICAgICAgIGNvbnRyb2xzLm1heEFyZWEuZ2V0VmFsdWUoKVxyXG4gICAgICAgICAgZWxzZSB1bmRlZmluZWRcclxuICAgICAgICBtaW5Sb29tQXJlYTpcclxuICAgICAgICAgIGlmIGNvbnRyb2xzLm1pbkFyZWEuZ2V0VG9nZ2xlU3RhdGUoKVxyXG4gICAgICAgICAgICBjb250cm9scy5taW5BcmVhLmdldFZhbHVlKClcclxuICAgICAgICAgIGVsc2UgdW5kZWZpbmVkXHJcbiAgICAgIH0sXHJcbiAgICAgIChtYXAsIHN0ZXApIC0+XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJTdGVwICMje3N0ZXB9OiBcIiwgbWFwLnJvb21MaXN0KVxyXG4gICAgICAgIHN0ZXBzLnB1c2ggbWFwXHJcbiAgICApXHJcbiAgICBkcmF3U3RlcEJ5U3RlcCBjYW52YXMsIHN0ZXBzXHJcblxyXG4gIGRyYXdNYXAgPSAoY2FudmFzLCBtYXApIC0+XHJcbiAgICAkKCcjcm9vbS1saXN0JykuZW1wdHkoKVxyXG4gICAgZm9yIHJvb20gaW4gbWFwLnJvb21MaXN0XHJcbiAgICAgICQoJyNyb29tLWxpc3QnKS5hcHBlbmQgXCJcIlwiXHJcbiAgICAgICAgPGRpdj48c3Ryb25nPlJvb20gIyN7cm9vbS5pZH06IDwvc3Ryb25nPiB7XHJcbiAgICAgICAgICB4OiAje3Jvb20ueH0sIHk6ICN7cm9vbS55fSwgd2lkdGg6ICN7cm9vbS53aWR0aH0sIGhlaWdodDogI3tyb29tLmhlaWdodH1cclxuICAgICAgICB9PC9kaXY+XHJcbiAgICAgIFwiXCJcIlxyXG4gICAgdGlsZW1hcCA9IG1hcC5nZXRUaWxlbWFwKHByb3BlcnRpZXMudGlsZXNQZXJVbml0LmdldCgpKVxyXG4gICAgY2FudmFzLmRyYXdNYXAodGlsZW1hcCwgcHJvcGVydGllcy5kcmF3R3JpZC5nZXQoKSwgcHJvcGVydGllcy53YWxsU3R5bGUuZ2V0KCkpXHJcblxyXG4gIGRyYXdTdGVwQnlTdGVwID0gKGNhbnZhcywgc3RlcHMsIGkgPSAwKSAtPlxyXG4gICAgJCgnI2dlbmVyYXRlJykuYXR0cignZGlzYWJsZWQnLCAnJylcclxuICAgIGRyYXdpbmcgPSB0cnVlXHJcbiAgICBkcmF3TWFwIGNhbnZhcywgc3RlcHMuc2hpZnQoKVxyXG4gICAgaWYgc3RlcHMubGVuZ3RoID4gMFxyXG4gICAgICBzZXRUaW1lb3V0KCgoKSAtPiBkcmF3U3RlcEJ5U3RlcChjYW52YXMsIHN0ZXBzKSksIDI1MClcclxuICAgIGVsc2VcclxuICAgICAgJCgnI2dlbmVyYXRlJykucmVtb3ZlQXR0cignZGlzYWJsZWQnLCAnJylcclxuICAgICAgZHJhd2luZyA9IGZhbHNlXHJcblxyXG4gICMgQWRkIGNvbnRyb2xzIHRvIHRoZSBwYWdlXHJcbiAgJCgnI3JlbmRlcmVyLWNvbnRyb2xzJykuYXBwZW5kKHZhbHVlLmh0bWwpIGZvciBvd24ga2V5LCB2YWx1ZSBvZiBwcm9wZXJ0aWVzXHJcbiAgJCgnI2dlbmVyYXRvci1jb250cm9scycpLmFwcGVuZCh2YWx1ZS5odG1sKSBmb3Igb3duIGtleSwgdmFsdWUgb2YgY29udHJvbHNcclxuXHJcbiAgIyBCaW5kIGZ1bmN0aW9ucyB0byBidXR0b25zXHJcbiAgJChcIiNnZW5lcmF0ZVwiKS5jbGljayhnZW5lcmF0ZU1hcClcclxuXHJcbiAgIyBFbmFibGUgdG9vbHRpcHMgd2l0aCBib290c3RyYXBcclxuICAkKCdbZGF0YS10b2dsZT1cInRvb2x0aXBcIl0nKS50b29sdGlwKClcclxuXHJcbiAgIyBTZXQgZGVmYXVsdCB2YWx1ZXMgdG8gdGhlIGlucHV0c1xyXG4gIGNvbnRyb2xzLm1hcFNpemUuc2V0KERlZmF1bHRzLk1BUF9TSVpFKVxyXG4gIGNvbnRyb2xzLm51bWJlck9mUm9vbXMuc2V0KERlZmF1bHRzLk5VTUJFUl9PRl9ST09NUylcclxuICBjb250cm9scy5pbml0aWFsUm9vbVcuc2V0KERlZmF1bHRzLklOSVRJQUxfUk9PTV9XSURUSClcclxuICBjb250cm9scy5pbml0aWFsUm9vbUguc2V0KERlZmF1bHRzLklOSVRJQUxfUk9PTV9IRUlHSFQpXHJcbiAgY29udHJvbHMubWluUm9vbVNpemUuc2V0KERlZmF1bHRzLk1JTl9ST09NX1NJWkUpXHJcbiAgY29udHJvbHMubWF4Um9vbVNpemUuc2V0KERlZmF1bHRzLk1BWF9ST09NX1NJWkUpXHJcbiAgY29udHJvbHMubWluQXJlYS5zZXQoRGVmYXVsdHMuTUlOX1JPT01fQVJFQSlcclxuICBjb250cm9scy5taW5BcmVhLnRvZ2dsZSh0cnVlKVxyXG4gIGNvbnRyb2xzLm1heEFyZWEuc2V0KERlZmF1bHRzLk1BWF9ST09NX0FSRUEpXHJcbiAgY29udHJvbHMubWF4QXJlYS50b2dnbGUoZmFsc2UpXHJcbiAgY29udHJvbHMucmF0aW9SZXN0ci5zZXQoRGVmYXVsdHMuUkFUSU9fUkVTVFJJQ1RJT04pXHJcbiAgY29udHJvbHMucmF0aW9SZXN0ci50b2dnbGUoZmFsc2UpXHJcblxyXG4gIHByb3BlcnRpZXMudGlsZXNQZXJVbml0LnNldChEZWZhdWx0cy5USUxFU19QRVJfVU5JVClcclxuICBwcm9wZXJ0aWVzLndhbGxTdHlsZS5zZXQoMilcclxuICBwcm9wZXJ0aWVzLmRyYXdHcmlkLnNldCh0cnVlKVxyXG5cclxuICAjIFNldCBsaXN0ZW5lciB0byBhdXRvLXVwZGF0ZWQgaW5wdXRzXHJcbiAgcHJvcGVydGllcy50aWxlc1BlclVuaXQuc2V0TGlzdGVuZXIoKCkgLT4gZHJhd01hcChjYW52YXMsIG1hcCkgdW5sZXNzIGRyYXdpbmcpXHJcbiAgcHJvcGVydGllcy53YWxsU3R5bGUuc2V0TGlzdGVuZXIoKCkgLT4gZHJhd01hcChjYW52YXMsIG1hcCkgdW5sZXNzIGRyYXdpbmcpXHJcbiAgcHJvcGVydGllcy5kcmF3R3JpZC5zZXRMaXN0ZW5lcigoKSAtPiBkcmF3TWFwKGNhbnZhcywgbWFwKSB1bmxlc3MgZHJhd2luZylcclxuXHJcbiAgIyBTZXQgbGlzdGVuZXIgdG8gdG9nZ2xlYWJsZSBpbnB1dHNcclxuICBjb250cm9scy5tYXhBcmVhLnNldFRvZ2dsZUxpc3RlbmVyICgpIC0+XHJcbiAgICBjb250cm9scy5tYXhBcmVhLnRvZ2dsZShjb250cm9scy5tYXhBcmVhLmdldFRvZ2dsZVN0YXRlKCkpXHJcbiAgY29udHJvbHMubWluQXJlYS5zZXRUb2dnbGVMaXN0ZW5lciAoKSAtPlxyXG4gICAgY29udHJvbHMubWluQXJlYS50b2dnbGUoY29udHJvbHMubWluQXJlYS5nZXRUb2dnbGVTdGF0ZSgpKVxyXG4gIGNvbnRyb2xzLnJhdGlvUmVzdHIuc2V0VG9nZ2xlTGlzdGVuZXIgKCkgLT5cclxuICAgIGNvbnRyb2xzLnJhdGlvUmVzdHIudG9nZ2xlKGNvbnRyb2xzLnJhdGlvUmVzdHIuZ2V0VG9nZ2xlU3RhdGUoKSlcclxuXHJcbiAgIyBHZW5lcmF0ZSBtYXAgb24gcGFnZSBsb2FkXHJcbiAgZ2VuZXJhdGVNYXAoKVxyXG4iXX0=