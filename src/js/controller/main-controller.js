var hasProp = {}.hasOwnProperty;

$(document).ready(function() {
  var canvas, controls, drawMap, drawStepByStep, drawing, generateMap, key, map, properties, value;
  drawing = false;
  canvas = new CanvasController('canvas');
  map = null;
  properties = {
    tilesPerUnit: new NumericInput('tilesPerUnit', 'Tiles per unit', 1),
    wallStyle: new SelectInput('wallStyle', "Wall style", wallStyle),
    drawGrid: new ToggleInput('drawGrid', "Draw grid"),
    showRoomList: new ToggleInput('showRoomList', "Show room list")
  };
  controls = {
    mapSize: new NumericInput('mapSize', 'Map size (units)', 5),
    numberOfRooms: new NumericInput('numberOfRooms', 'Number of rooms', 1),
    initialRoomW: new NumericInput('initialRoomW', 'Initial room width', 1),
    initialRoomH: new NumericInput('initialRoomH', 'Initial room height', 1),
    minRoomSize: new NumericInput('minRoomSize', 'Min. room size', 1),
    maxRoomSize: new NumericInput('maxRoomSize', 'Max. room size', 1),
    minArea: new ToggleableNumericInput('minArea', 'Min. room area', 1),
    maxArea: new ToggleableNumericInput('maxArea', 'Max. room area', 1),
    ratioRestr: new ToggleableNumericInput('ratioRestr', 'Ratio restr.', 0.5, 1, 0.1)
  };
  generateMap = function() {
    var steps;
    steps = [];
    map = generate(controls.numberOfRooms.get(), {
      width: controls.mapSize.get(),
      height: controls.mapSize.get(),
      initialRoomWidth: controls.initialRoomW.get(),
      initialRoomHeight: controls.initialRoomH.get(),
      minRoomSize: controls.minRoomSize.get(),
      maxRoomSize: controls.maxRoomSize.get(),
      ratioRestriction: controls.ratioRestr.getToggleState() ? controls.ratioRestr.getValue() : void 0,
      maxRoomArea: controls.maxArea.getToggleState() ? controls.maxArea.getValue() : void 0,
      minRoomArea: controls.minArea.getToggleState() ? controls.minArea.getValue() : void 0
    }, function(map, step) {
      console.log("Step #" + step + ": ", map.roomList);
      return steps.push(map);
    });
    return drawStepByStep(canvas, steps);
  };
  drawMap = function(canvas, map) {
    var j, len, ref, room, tilemap;
    $('#room-list').empty();
    if (properties.showRoomList.get()) {
      ref = map.roomList;
      for (j = 0, len = ref.length; j < len; j++) {
        room = ref[j];
        $('#room-list').append("<div><strong>Room #" + room.id + ": </strong> {\n  x: " + room.x + ", y: " + room.y + ", width: " + room.width + ", height: " + room.height + "\n}</div>");
      }
    }
    tilemap = map.getTilemap(properties.tilesPerUnit.get());
    return canvas.drawMap(tilemap, properties.drawGrid.get(), properties.wallStyle.get());
  };
  drawStepByStep = function(canvas, steps, i) {
    if (i == null) {
      i = 0;
    }
    $('#generate').attr('disabled', '');
    drawing = true;
    drawMap(canvas, steps.shift());
    if (steps.length > 0) {
      return setTimeout((function() {
        return drawStepByStep(canvas, steps);
      }), 250);
    } else {
      $('#generate').removeAttr('disabled', '');
      return drawing = false;
    }
  };
  for (key in properties) {
    if (!hasProp.call(properties, key)) continue;
    value = properties[key];
    $('#renderer-controls').append(value.html);
  }
  for (key in controls) {
    if (!hasProp.call(controls, key)) continue;
    value = controls[key];
    $('#generator-controls').append(value.html);
  }
  $("#generate").click(generateMap);
  $('[data-togle="tooltip"]').tooltip();
  controls.mapSize.set(Defaults.MAP_SIZE);
  controls.numberOfRooms.set(Defaults.NUMBER_OF_ROOMS);
  controls.initialRoomW.set(Defaults.INITIAL_ROOM_WIDTH);
  controls.initialRoomH.set(Defaults.INITIAL_ROOM_HEIGHT);
  controls.minRoomSize.set(Defaults.MIN_ROOM_SIZE);
  controls.maxRoomSize.set(Defaults.MAX_ROOM_SIZE);
  controls.minArea.set(Defaults.MIN_ROOM_AREA);
  controls.minArea.toggle(true);
  controls.maxArea.set(Defaults.MAX_ROOM_AREA);
  controls.maxArea.toggle(false);
  controls.ratioRestr.set(Defaults.RATIO_RESTRICTION);
  controls.ratioRestr.toggle(false);
  properties.tilesPerUnit.set(Defaults.TILES_PER_UNIT);
  properties.wallStyle.set(2);
  properties.drawGrid.set(true);
  properties.tilesPerUnit.setListener(function() {
    if (!drawing) {
      return drawMap(canvas, map);
    }
  });
  properties.wallStyle.setListener(function() {
    if (!drawing) {
      return drawMap(canvas, map);
    }
  });
  properties.drawGrid.setListener(function() {
    if (!drawing) {
      return drawMap(canvas, map);
    }
  });
  properties.showRoomList.setListener(function() {
    if (!drawing) {
      return drawMap(canvas, map);
    }
  });
  controls.maxArea.setToggleListener(function() {
    return controls.maxArea.toggle(controls.maxArea.getToggleState());
  });
  controls.minArea.setToggleListener(function() {
    return controls.minArea.toggle(controls.minArea.getToggleState());
  });
  controls.ratioRestr.setToggleListener(function() {
    return controls.ratioRestr.toggle(controls.ratioRestr.getToggleState());
  });
  return generateMap();
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRyb2xsZXIvbWFpbi1jb250cm9sbGVyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztBQUFBLENBQUEsQ0FBRSxRQUFGLENBQVcsQ0FBQyxLQUFaLENBQWtCLFNBQUE7QUFFaEIsTUFBQTtFQUFBLE9BQUEsR0FBVTtFQUNWLE1BQUEsR0FBYSxJQUFBLGdCQUFBLENBQWlCLFFBQWpCO0VBQ2IsR0FBQSxHQUFNO0VBR04sVUFBQSxHQUNFO0lBQUEsWUFBQSxFQUFtQixJQUFBLFlBQUEsQ0FBYSxjQUFiLEVBQTZCLGdCQUE3QixFQUErQyxDQUEvQyxDQUFuQjtJQUNBLFNBQUEsRUFBbUIsSUFBQSxXQUFBLENBQVksV0FBWixFQUF5QixZQUF6QixFQUF1QyxTQUF2QyxDQURuQjtJQUVBLFFBQUEsRUFBbUIsSUFBQSxXQUFBLENBQVksVUFBWixFQUF3QixXQUF4QixDQUZuQjtJQUdBLFlBQUEsRUFBbUIsSUFBQSxXQUFBLENBQVksY0FBWixFQUE0QixnQkFBNUIsQ0FIbkI7O0VBT0YsUUFBQSxHQUNFO0lBQUEsT0FBQSxFQUFvQixJQUFBLFlBQUEsQ0FBYSxTQUFiLEVBQXdCLGtCQUF4QixFQUE0QyxDQUE1QyxDQUFwQjtJQUNBLGFBQUEsRUFBb0IsSUFBQSxZQUFBLENBQWEsZUFBYixFQUE4QixpQkFBOUIsRUFBaUQsQ0FBakQsQ0FEcEI7SUFFQSxZQUFBLEVBQW9CLElBQUEsWUFBQSxDQUFhLGNBQWIsRUFBNkIsb0JBQTdCLEVBQW1ELENBQW5ELENBRnBCO0lBR0EsWUFBQSxFQUFvQixJQUFBLFlBQUEsQ0FBYSxjQUFiLEVBQTZCLHFCQUE3QixFQUFvRCxDQUFwRCxDQUhwQjtJQUlBLFdBQUEsRUFBb0IsSUFBQSxZQUFBLENBQWEsYUFBYixFQUE0QixnQkFBNUIsRUFBOEMsQ0FBOUMsQ0FKcEI7SUFLQSxXQUFBLEVBQW9CLElBQUEsWUFBQSxDQUFhLGFBQWIsRUFBNEIsZ0JBQTVCLEVBQThDLENBQTlDLENBTHBCO0lBTUEs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QUFqQixDQUFtQyxTQUFBO1dBQ2pDLFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBakIsQ0FBd0IsUUFBUSxDQUFDLE9BQU8sQ0FBQyxjQUFqQixDQUFBLENBQXhCO0VBRGlDLENBQW5DO0VBRUEsUUFBUSxDQUFDLE9BQU8sQ0FBQyxpQkFBakIsQ0FBbUMsU0FBQTtXQUNqQyxRQUFRLENBQUMsT0FBTyxDQUFDLE1BQWpCLENBQXdCLFFBQVEsQ0FBQyxPQUFPLENBQUMsY0FBakIsQ0FBQSxDQUF4QjtFQURpQyxDQUFuQztFQUVBLFFBQVEsQ0FBQyxVQUFVLENBQUMsaUJBQXBCLENBQXNDLFNBQUE7V0FDcEMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxNQUFwQixDQUEyQixRQUFRLENBQUMsVUFBVSxDQUFDLGNBQXBCLENBQUEsQ0FBM0I7RUFEb0MsQ0FBdEM7U0FJQSxXQUFBLENBQUE7QUF6SGdCLENBQWxCIiwiZmlsZSI6ImNvbnRyb2xsZXIvbWFpbi1jb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiJChkb2N1bWVudCkucmVhZHkgKCkgLT5cblxuICBkcmF3aW5nID0gZmFsc2VcbiAgY2FudmFzID0gbmV3IENhbnZhc0NvbnRyb2xsZXIgJ2NhbnZhcydcbiAgbWFwID0gbnVsbFxuXG4gICMgUkVOREVSRVIgUFJPUEVSVElFU1xuICBwcm9wZXJ0aWVzID1cbiAgICB0aWxlc1BlclVuaXQgOiBuZXcgTnVtZXJpY0lucHV0KCd0aWxlc1BlclVuaXQnLCAnVGlsZXMgcGVyIHVuaXQnLCAxKVxuICAgIHdhbGxTdHlsZSAgICA6IG5ldyBTZWxlY3RJbnB1dCgnd2FsbFN0eWxlJywgXCJXYWxsIHN0eWxlXCIsIHdhbGxTdHlsZSlcbiAgICBkcmF3R3JpZCAgICAgOiBuZXcgVG9nZ2xlSW5wdXQoJ2RyYXdHcmlkJywgXCJEcmF3IGdyaWRcIilcbiAgICBzaG93Um9vbUxpc3QgOiBuZXcgVG9nZ2xlSW5wdXQoJ3Nob3dSb29tTGlzdCcsIFwiU2hvdyByb29tIGxpc3RcIilcbiAgICAjIGRlYnVnTW9kZSAgICA6IG5ldyBUb2dnbGVJbnB1dCgnZGVidWdNb2RlJywgXCJTaG93IGRlYnVnIGluZm9cIiwgdHJ1ZSlcblxuICAjIEdFTkVSQVRPUiBDT05UUk9MU1xuICBjb250cm9scyA9XG4gICAgbWFwU2l6ZSAgICAgICA6IG5ldyBOdW1lcmljSW5wdXQoJ21hcFNpemUnLCAnTWFwIHNpemUgKHVuaXRzKScsIDUpXG4gICAgbnVtYmVyT2ZSb29tcyA6IG5ldyBOdW1lcmljSW5wdXQoJ251bWJlck9mUm9vbXMnLCAnTnVtYmVyIG9mIHJvb21zJywgMSlcbiAgICBpbml0aWFsUm9vbVcgIDogbmV3IE51bWVyaWNJbnB1dCgnaW5pdGlhbFJvb21XJywgJ0luaXRpYWwgcm9vbSB3aWR0aCcsIDEpXG4gICAgaW5pdGlhbFJvb21IICA6IG5ldyBOdW1lcmljSW5wdXQoJ2luaXRpYWxSb29tSCcsICdJbml0aWFsIHJvb20gaGVpZ2h0JywgMSlcbiAgICBtaW5Sb29tU2l6ZSAgIDogbmV3IE51bWVyaWNJbnB1dCgnbWluUm9vbVNpemUnLCAnTWluLiByb29tIHNpemUnLCAxKVxuICAgIG1heFJvb21TaXplICAgOiBuZXcgTnVtZXJpY0lucHV0KCdtYXhSb29tU2l6ZScsICdNYXguIHJvb20gc2l6ZScsIDEpXG4gICAgbWluQXJlYTogbmV3IFRvZ2dsZWFibGVOdW1lcmljSW5wdXQoJ21pbkFyZWEnLCAnTWluLiByb29tIGFyZWEnLCAxKVxuICAgIG1heEFyZWE6IG5ldyBUb2dnbGVhYmxlTnVtZXJpY0lucHV0KCdtYXhBcmVhJywgJ01heC4gcm9vbSBhcmVhJywgMSlcbiAgICByYXRpb1Jlc3RyOiBuZXcgVG9nZ2xlYWJsZU51bWVyaWNJbnB1dCgncmF0aW9SZXN0cicsICdSYXRpbyByZXN0ci4nLCAwLjUsIDEsIDAuMSlcblxuICAjIEZVTkNUSU9OIERFRklOSVRJT05cbiAgZ2VuZXJhdGVNYXAgPSAoKSAtPlxuICAgIHN0ZXBzID0gW11cbiAgICBtYXAgPSBnZW5lcmF0ZShcbiAgICAgIGNvbnRyb2xzLm51bWJlck9mUm9vbXMuZ2V0KCksXG4gICAgICB7XG4gICAgICAgIHdpZHRoOiBjb250cm9scy5tYXBTaXplLmdldCgpXG4gICAgICAgIGhlaWdodDogY29udHJvbHMubWFwU2l6ZS5nZXQoKVxuICAgICAgICBpbml0aWFsUm9vbVdpZHRoOiBjb250cm9scy5pbml0aWFsUm9vbVcuZ2V0KClcbiAgICAgICAgaW5pdGlhbFJvb21IZWlnaHQ6IGNvbnRyb2xzLmluaXRpYWxSb29tSC5nZXQoKVxuICAgICAgICBtaW5Sb29tU2l6ZTogY29udHJvbHMubWluUm9vbVNpemUuZ2V0KClcbiAgICAgICAgbWF4Um9vbVNpemU6IGNvbnRyb2xzLm1heFJvb21TaXplLmdldCgpXG4gICAgICAgIHJhdGlvUmVzdHJpY3Rpb246XG4gICAgICAgICAgaWYgY29udHJvbHMucmF0aW9SZXN0ci5nZXRUb2dnbGVTdGF0ZSgpXG4gICAgICAgICAgICBjb250cm9scy5yYXRpb1Jlc3RyLmdldFZhbHVlKClcbiAgICAgICAgICBlbHNlIHVuZGVmaW5lZFxuICAgICAgICBtYXhSb29tQXJlYTpcbiAgICAgICAgICBpZiBjb250cm9scy5tYXhBcmVhLmdldFRvZ2dsZVN0YXRlKClcbiAgICAgICAgICAgIGNvbnRyb2xzLm1heEFyZWEuZ2V0VmFsdWUoKVxuICAgICAgICAgIGVsc2UgdW5kZWZpbmVkXG4gICAgICAgIG1pblJvb21BcmVhOlxuICAgICAgICAgIGlmIGNvbnRyb2xzLm1pbkFyZWEuZ2V0VG9nZ2xlU3RhdGUoKVxuICAgICAgICAgICAgY29udHJvbHMubWluQXJlYS5nZXRWYWx1ZSgpXG4gICAgICAgICAgZWxzZSB1bmRlZmluZWRcbiAgICAgIH0sXG4gICAgICAobWFwLCBzdGVwKSAtPlxuICAgICAgICBjb25zb2xlLmxvZyhcIlN0ZXAgIyN7c3RlcH06IFwiLCBtYXAucm9vbUxpc3QpXG4gICAgICAgIHN0ZXBzLnB1c2ggbWFwXG4gICAgKVxuICAgIGRyYXdTdGVwQnlTdGVwIGNhbnZhcywgc3RlcHNcblxuICBkcmF3TWFwID0gKGNhbnZhcywgbWFwKSAtPlxuICAgICQoJyNyb29tLWxpc3QnKS5lbXB0eSgpXG4gICAgaWYgcHJvcGVydGllcy5zaG93Um9vbUxpc3QuZ2V0KCkgdGhlbiBmb3Igcm9vbSBpbiBtYXAucm9vbUxpc3RcbiAgICAgICQoJyNyb29tLWxpc3QnKS5hcHBlbmQgXCJcIlwiXG4gICAgICAgIDxkaXY+PHN0cm9uZz5Sb29tICMje3Jvb20uaWR9OiA8L3N0cm9uZz4ge1xuICAgICAgICAgIHg6ICN7cm9vbS54fSwgeTogI3tyb29tLnl9LCB3aWR0aDogI3tyb29tLndpZHRofSwgaGVpZ2h0OiAje3Jvb20uaGVpZ2h0fVxuICAgICAgICB9PC9kaXY+XG4gICAgICBcIlwiXCJcbiAgICB0aWxlbWFwID0gbWFwLmdldFRpbGVtYXAocHJvcGVydGllcy50aWxlc1BlclVuaXQuZ2V0KCkpXG4gICAgY2FudmFzLmRyYXdNYXAodGlsZW1hcCwgcHJvcGVydGllcy5kcmF3R3JpZC5nZXQoKSwgcHJvcGVydGllcy53YWxsU3R5bGUuZ2V0KCkpXG5cbiAgZHJhd1N0ZXBCeVN0ZXAgPSAoY2FudmFzLCBzdGVwcywgaSA9IDApIC0+XG4gICAgJCgnI2dlbmVyYXRlJykuYXR0cignZGlzYWJsZWQnLCAnJylcbiAgICBkcmF3aW5nID0gdHJ1ZVxuICAgIGRyYXdNYXAgY2FudmFzLCBzdGVwcy5zaGlmdCgpXG4gICAgaWYgc3RlcHMubGVuZ3RoID4gMFxuICAgICAgc2V0VGltZW91dCgoKCkgLT4gZHJhd1N0ZXBCeVN0ZXAoY2FudmFzLCBzdGVwcykpLCAyNTApXG4gICAgZWxzZVxuICAgICAgJCgnI2dlbmVyYXRlJykucmVtb3ZlQXR0cignZGlzYWJsZWQnLCAnJylcbiAgICAgIGRyYXdpbmcgPSBmYWxzZVxuXG4gICMgQWRkIGNvbnRyb2xzIHRvIHRoZSBwYWdlXG4gICQoJyNyZW5kZXJlci1jb250cm9scycpLmFwcGVuZCh2YWx1ZS5odG1sKSBmb3Igb3duIGtleSwgdmFsdWUgb2YgcHJvcGVydGllc1xuICAkKCcjZ2VuZXJhdG9yLWNvbnRyb2xzJykuYXBwZW5kKHZhbHVlLmh0bWwpIGZvciBvd24ga2V5LCB2YWx1ZSBvZiBjb250cm9sc1xuXG4gICMgQmluZCBmdW5jdGlvbnMgdG8gYnV0dG9uc1xuICAkKFwiI2dlbmVyYXRlXCIpLmNsaWNrKGdlbmVyYXRlTWFwKVxuXG4gICMgRW5hYmxlIHRvb2x0aXBzIHdpdGggYm9vdHN0cmFwXG4gICQoJ1tkYXRhLXRvZ2xlPVwidG9vbHRpcFwiXScpLnRvb2x0aXAoKVxuXG4gICMgU2V0IGRlZmF1bHQgdmFsdWVzIHRvIHRoZSBpbnB1dHNcbiAgY29udHJvbHMubWFwU2l6ZS5zZXQoRGVmYXVsdHMuTUFQX1NJWkUpXG4gIGNvbnRyb2xzLm51bWJlck9mUm9vbXMuc2V0KERlZmF1bHRzLk5VTUJFUl9PRl9ST09NUylcbiAgY29udHJvbHMuaW5pdGlhbFJvb21XLnNldChEZWZhdWx0cy5JTklUSUFMX1JPT01fV0lEVEgpXG4gIGNvbnRyb2xzLmluaXRpYWxSb29tSC5zZXQoRGVmYXVsdHMuSU5JVElBTF9ST09NX0hFSUdIVClcbiAgY29udHJvbHMubWluUm9vbVNpemUuc2V0KERlZmF1bHRzLk1JTl9ST09NX1NJWkUpXG4gIGNvbnRyb2xzLm1heFJvb21TaXplLnNldChEZWZhdWx0cy5NQVhfUk9PTV9TSVpFKVxuICBjb250cm9scy5taW5BcmVhLnNldChEZWZhdWx0cy5NSU5fUk9PTV9BUkVBKVxuICBjb250cm9scy5taW5BcmVhLnRvZ2dsZSh0cnVlKVxuICBjb250cm9scy5tYXhBcmVhLnNldChEZWZhdWx0cy5NQVhfUk9PTV9BUkVBKVxuICBjb250cm9scy5tYXhBcmVhLnRvZ2dsZShmYWxzZSlcbiAgY29udHJvbHMucmF0aW9SZXN0ci5zZXQoRGVmYXVsdHMuUkFUSU9fUkVTVFJJQ1RJT04pXG4gIGNvbnRyb2xzLnJhdGlvUmVzdHIudG9nZ2xlKGZhbHNlKVxuXG4gIHByb3BlcnRpZXMudGlsZXNQZXJVbml0LnNldChEZWZhdWx0cy5USUxFU19QRVJfVU5JVClcbiAgcHJvcGVydGllcy53YWxsU3R5bGUuc2V0KDIpXG4gIHByb3BlcnRpZXMuZHJhd0dyaWQuc2V0KHRydWUpXG5cbiAgIyBTZXQgbGlzdGVuZXIgdG8gYXV0by11cGRhdGVkIGlucHV0c1xuICBwcm9wZXJ0aWVzLnRpbGVzUGVyVW5pdC5zZXRMaXN0ZW5lcigoKSAtPiBkcmF3TWFwKGNhbnZhcywgbWFwKSB1bmxlc3MgZHJhd2luZylcbiAgcHJvcGVydGllcy53YWxsU3R5bGUuc2V0TGlzdGVuZXIoKCkgLT4gZHJhd01hcChjYW52YXMsIG1hcCkgdW5sZXNzIGRyYXdpbmcpXG4gIHByb3BlcnRpZXMuZHJhd0dyaWQuc2V0TGlzdGVuZXIoKCkgLT4gZHJhd01hcChjYW52YXMsIG1hcCkgdW5sZXNzIGRyYXdpbmcpXG4gIHByb3BlcnRpZXMuc2hvd1Jvb21MaXN0LnNldExpc3RlbmVyKCgpIC0+IGRyYXdNYXAoY2FudmFzLCBtYXApIHVubGVzcyBkcmF3aW5nKVxuXG4gICMgU2V0IGxpc3RlbmVyIHRvIHRvZ2dsZWFibGUgaW5wdXRzXG4gIGNvbnRyb2xzLm1heEFyZWEuc2V0VG9nZ2xlTGlzdGVuZXIgKCkgLT5cbiAgICBjb250cm9scy5tYXhBcmVhLnRvZ2dsZShjb250cm9scy5tYXhBcmVhLmdldFRvZ2dsZVN0YXRlKCkpXG4gIGNvbnRyb2xzLm1pbkFyZWEuc2V0VG9nZ2xlTGlzdGVuZXIgKCkgLT5cbiAgICBjb250cm9scy5taW5BcmVhLnRvZ2dsZShjb250cm9scy5taW5BcmVhLmdldFRvZ2dsZVN0YXRlKCkpXG4gIGNvbnRyb2xzLnJhdGlvUmVzdHIuc2V0VG9nZ2xlTGlzdGVuZXIgKCkgLT5cbiAgICBjb250cm9scy5yYXRpb1Jlc3RyLnRvZ2dsZShjb250cm9scy5yYXRpb1Jlc3RyLmdldFRvZ2dsZVN0YXRlKCkpXG5cbiAgIyBHZW5lcmF0ZSBtYXAgb24gcGFnZSBsb2FkXG4gIGdlbmVyYXRlTWFwKClcbiJdfQ==