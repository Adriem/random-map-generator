var CanvasController, Color, wall;

Color = {
  GRID: "#211",
  BACKGROUND: "#fff",
  WALL: "#200",
  GROUND: "#622",
  DOOR: "#844",
  START_POINT: "#450"
};

wall = ['NONE', 'TILE', 'COMPOSED'];

CanvasController = (function() {
  function CanvasController(id) {
    this.id = id;
    this.canvas = $('#' + this.id)[0].getContext("2d");
  }

  CanvasController.prototype.getWidth = function() {
    return parseInt($('#' + this.id).attr("width"));
  };

  CanvasController.prototype.calculateTileSize = function(numberOfTiles) {
    return Math.floor(this.getWidth() / numberOfTiles);
  };

  CanvasController.prototype.calculateGridWidth = function(tileSize) {
    return Math.floor(tileSize / 10);
  };

  CanvasController.prototype.calculateWallSize = function(tileSize) {
    return Math.floor(tileSize / 3);
  };

  CanvasController.prototype.drawMap = function(tilemap, drawGrid, showWalls) {
    var i, j, ref, ref1, tileSize, x, y;
    if (drawGrid == null) {
      drawGrid = true;
    }
    if (showWalls == null) {
      showWalls = 1;
    }
    tileSize = this.calculateTileSize(tilemap.width);
    this.canvas.fillStyle = Color.BACKGROUND;
    this.canvas.fillRect(0, 0, this.getWidth(), this.getWidth());
    for (y = i = 0, ref = tilemap.height; 0 <= ref ? i < ref : i > ref; y = 0 <= ref ? ++i : --i) {
      for (x = j = 0, ref1 = tilemap.width; 0 <= ref1 ? j < ref1 : j > ref1; x = 0 <= ref1 ? ++j : --j) {
        switch (tilemap[x][y]) {
          case Tile.GROUND:
            this.drawTile(x, y, tileSize, Color.GROUND);
            break;
          case Tile.WALL:
            if (wall[showWalls] === 'TILE') {
              this.drawTile(x, y, tileSize, Color.WALL);
            } else if (wall[showWalls] === 'COMPOSED') {
              this.drawWall(x, y, tileSize, Color.WALL, tilemap);
            }
            break;
          case Tile.DOOR:
            this.drawTile(x, y, tileSize, Color.DOOR);
        }
      }
    }
    if (drawGrid) {
      return this.drawGrid(tilemap);
    }
  };

  CanvasController.prototype.drawTile = function(x, y, size, value) {
    this.canvas.fillStyle = value;
    return this.canvas.fillRect(x * size, y * size, size, size);
  };

  CanvasController.prototype.drawWall = function(x, y, size, value, tilemap) {
    var flags, wallSize;
    flags = {
      north: !tilemap.is(x, y - 1, 1, 1, Tile.EMPTY) && !tilemap.is(x, y - 1, 1, 1, Tile.WALL) && y > 1,
      south: !tilemap.is(x, y + 1, 1, 1, Tile.EMPTY) && !tilemap.is(x, y + 1, 1, 1, Tile.WALL) && y < tilemap.height - 1,
      east: !tilemap.is(x + 1, y, 1, 1, Tile.EMPTY) && !tilemap.is(x + 1, y, 1, 1, Tile.WALL) && x < tilemap.width - 1,
      west: !tilemap.is(x - 1, y, 1, 1, Tile.EMPTY) && !tilemap.is(x - 1, y, 1, 1, Tile.WALL) && x > 1,
      northwest: !tilemap.is(x - 1, y - 1, 1, 1, Tile.EMPTY) && !tilemap.is(x - 1, y - 1, 1, 1, Tile.WALL) && y > 1 && x > 1,
      northeast: !tilemap.is(x + 1, y - 1, 1, 1, Tile.EMPTY) && !tilemap.is(x + 1, y - 1, 1, 1, Tile.WALL) && y > 1 && x < tilemap.width - 1,
      southwest: !tilemap.is(x - 1, y + 1, 1, 1, Tile.EMPTY) && !tilemap.is(x - 1, y + 1, 1, 1, Tile.WALL) && y < tilemap.height - 1 && x > 1,
      southeast: !tilemap.is(x + 1, y + 1, 1, 1, Tile.EMPTY) && !tilemap.is(x + 1, y + 1, 1, 1, Tile.WALL) && y < tilemap.height - 1 && x < tilemap.width - 1
    };
    wallSize = this.calculateWallSize(size);
    this.canvas.fillStyle = value;
    if (flags.north) {
      this.canvas.fillRect(x * size, y * size, size, wallSize);
    }
    if (flags.south) {
      this.canvas.fillRect(x * size, (y + 1) * size - wallSize, size, wallSize);
    }
    if (flags.east) {
      this.canvas.fillRect((x + 1) * size - wallSize, y * size, wallSize, size);
    }
    if (flags.west) {
      this.canvas.fillRect(x * size, y * size, wallSize, size);
    }
    if (flags.northwest) {
      this.canvas.fillRect(x * size, y * size, wallSize, wallSize);
    }
    if (flags.northeast) {
      this.canvas.fillRect((x + 1) * size - wallSize, y * size, wallSize, wallSize);
    }
    if (flags.southeast) {
      this.canvas.fillRect((x + 1) * size - wallSize, (y + 1) * size - wallSize, wallSize, wallSize);
    }
    if (flags.southwest) {
      return this.canvas.fillRect(x * size, (y + 1) * size - wallSize, wallSize, wallSize);
    }
  };

  CanvasController.prototype.drawGrid = function(tilemap) {
    var i, ref, tileSize, x;
    tileSize = this.calculateTileSize(tilemap.width);
    this.canvas.beginPath();
    this.canvas.strokeStyle = Color.GRID;
    for (x = i = 0, ref = tilemap.width; 0 <= ref ? i <= ref : i >= ref; x = 0 <= ref ? ++i : --i) {
      this.canvas.moveTo(x * tileSize, 0);
      this.canvas.lineTo(x * tileSize, tilemap.width * tileSize);
      this.canvas.moveTo(0, x * tileSize);
      this.canvas.lineTo(tilemap.width * tileSize, x * tileSize);
    }
    this.canvas.lineWidth = this.calculateGridWidth(tileSize);
    this.canvas.stroke();
    return this.canvas.closePath();
  };

  return CanvasController;

})();

this.CanvasController = CanvasController;

this.wallStyle = wall;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRyb2xsZXIvY2FudmFzLWNvbnRyb2xsZXIuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBLElBQUE7O0FBQUEsS0FBQSxHQUNFO0VBQUEsSUFBQSxFQUFNLE1BQU47RUFDQSxVQUFBLEVBQVksTUFEWjtFQUVBLElBQUEsRUFBTSxNQUZOO0VBR0EsTUFBQSxFQUFRLE1BSFI7RUFJQSxJQUFBLEVBQU0sTUFKTjtFQUtBLFdBQUEsRUFBYSxNQUxiOzs7QUFPRixJQUFBLEdBQU8sQ0FBQyxNQUFELEVBQVMsTUFBVCxFQUFpQixVQUFqQjs7QUFHRDtFQUVTLDBCQUFDLEVBQUQ7SUFBQyxJQUFDLENBQUEsS0FBRDtJQUFRLElBQUMsQ0FBQSxNQUFELEdBQVUsQ0FBQSxDQUFFLEdBQUEsR0FBTSxJQUFDLENBQUEsRUFBVCxDQUFhLENBQUEsQ0FBQSxDQUFFLENBQUMsVUFBaEIsQ0FBMkIsSUFBM0I7RUFBbkI7OzZCQUViLFFBQUEsR0FBVSxTQUFBO1dBQU0sUUFBQSxDQUFTLENBQUEsQ0FBRSxHQUFBLEdBQU0sSUFBQyxDQUFBLEVBQVQsQ0FBWSxDQUFDLElBQWIsQ0FBa0IsT0FBbEIsQ0FBVDtFQUFOOzs2QkFFVixpQkFBQSxHQUFtQixTQUFDLGFBQUQ7c0JBQW1CLElBQUMsQ0FBQSxRQUFELENBQUEsSUFBZTtFQUFsQzs7NkJBRW5CLGtCQUFBLEdBQW9CLFNBQUMsUUFBRDtzQkFBYyxXQUFZO0VBQTFCOzs2QkFFcEIsaUJBQUEsR0FBbUIsU0FBQyxRQUFEO3NCQUFjLFdBQVk7RUFBMUI7OzZCQUVuQixPQUFBLEdBQVMsU0FBQyxPQUFELEVBQVUsUUFBVixFQUEyQixTQUEzQjtBQUNQLFFBQUE7O01BRGlCLFdBQVc7OztNQUFNLFlBQVk7O0lBQzlDLFFBQUEsR0FBVyxJQUFDLENBQUEsaUJBQUQsQ0FBbUIsT0FBTyxDQUFDLEtBQTNCO0lBQ1gsSUFBQyxDQUFBLE1BQU0sQ0FBQyxTQUFSLEdBQW9CLEtBQUssQ0FBQztJQUMxQixJQUFDLENB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QSxNQUFNLENBQUMsUUFBUixDQUFpQixDQUFBLEdBQUksSUFBckIsRUFBMkIsQ0FBQyxDQUFBLEdBQUksQ0FBTCxDQUFBLEdBQVUsSUFBVixHQUFpQixRQUE1QyxFQUNJLFFBREosRUFDYyxRQURkLEVBQUE7O0VBakNROzs2QkFvQ1YsUUFBQSxHQUFVLFNBQUMsT0FBRDtBQUNSLFFBQUE7SUFBQSxRQUFBLEdBQVcsSUFBQyxDQUFBLGlCQUFELENBQW1CLE9BQU8sQ0FBQyxLQUEzQjtJQUNYLElBQUMsQ0FBQSxNQUFNLENBQUMsU0FBUixDQUFBO0lBQ0EsSUFBQyxDQUFBLE1BQU0sQ0FBQyxXQUFSLEdBQXNCLEtBQUssQ0FBQztBQUM1QixTQUFTLHdGQUFUO01BQ0UsSUFBQyxDQUFBLE1BQU0sQ0FBQyxNQUFSLENBQWUsQ0FBQSxHQUFJLFFBQW5CLEVBQTZCLENBQTdCO01BQ0EsSUFBQyxDQUFBLE1BQU0sQ0FBQyxNQUFSLENBQWUsQ0FBQSxHQUFJLFFBQW5CLEVBQTZCLE9BQU8sQ0FBQyxLQUFSLEdBQWdCLFFBQTdDO01BQ0EsSUFBQyxDQUFBLE1BQU0sQ0FBQyxNQUFSLENBQWUsQ0FBZixFQUFrQixDQUFBLEdBQUksUUFBdEI7TUFDQSxJQUFDLENBQUEsTUFBTSxDQUFDLE1BQVIsQ0FBZSxPQUFPLENBQUMsS0FBUixHQUFnQixRQUEvQixFQUF5QyxDQUFBLEdBQUksUUFBN0M7QUFKRjtJQUtBLElBQUMsQ0FBQSxNQUFNLENBQUMsU0FBUixHQUFvQixJQUFDLENBQUEsa0JBQUQsQ0FBb0IsUUFBcEI7SUFDcEIsSUFBQyxDQUFBLE1BQU0sQ0FBQyxNQUFSLENBQUE7V0FDQSxJQUFDLENBQUEsTUFBTSxDQUFDLFNBQVIsQ0FBQTtFQVhROzs7Ozs7QUFjWixJQUFJLENBQUMsZ0JBQUwsR0FBd0I7O0FBQ3hCLElBQUksQ0FBQyxTQUFMLEdBQWlCIiwiZmlsZSI6ImNvbnRyb2xsZXIvY2FudmFzLWNvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuIyAgVGhpcyBmaWxlIGRlZmluZXMgdGhlIGNvbnRyb2xsZXIgYW5kIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBjYW52YXNcbiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbkNvbG9yID1cbiAgR1JJRDogXCIjMjExXCJcbiAgQkFDS0dST1VORDogXCIjZmZmXCJcbiAgV0FMTDogXCIjMjAwXCJcbiAgR1JPVU5EOiBcIiM2MjJcIlxuICBET09SOiBcIiM4NDRcIlxuICBTVEFSVF9QT0lOVDogXCIjNDUwXCJcblxud2FsbCA9IFsnTk9ORScsICdUSUxFJywgJ0NPTVBPU0VEJ11cblxuXG5jbGFzcyBDYW52YXNDb250cm9sbGVyXG5cbiAgY29uc3RydWN0b3I6IChAaWQpIC0+IEBjYW52YXMgPSAkKCcjJyArIEBpZClbMF0uZ2V0Q29udGV4dChcIjJkXCIpXG5cbiAgZ2V0V2lkdGg6ICgpIC0+IHBhcnNlSW50ICQoJyMnICsgQGlkKS5hdHRyKFwid2lkdGhcIilcblxuICBjYWxjdWxhdGVUaWxlU2l6ZTogKG51bWJlck9mVGlsZXMpIC0+IEBnZXRXaWR0aCgpIC8vIG51bWJlck9mVGlsZXNcblxuICBjYWxjdWxhdGVHcmlkV2lkdGg6ICh0aWxlU2l6ZSkgLT4gdGlsZVNpemUgLy8gMTBcblxuICBjYWxjdWxhdGVXYWxsU2l6ZTogKHRpbGVTaXplKSAtPiB0aWxlU2l6ZSAvLyAzXG5cbiAgZHJhd01hcDogKHRpbGVtYXAsIGRyYXdHcmlkID0gdHJ1ZSwgc2hvd1dhbGxzID0gMSkgLT5cbiAgICB0aWxlU2l6ZSA9IEBjYWxjdWxhdGVUaWxlU2l6ZSh0aWxlbWFwLndpZHRoKVxuICAgIEBjYW52YXMuZmlsbFN0eWxlID0gQ29sb3IuQkFDS0dST1VORFxuICAgIEBjYW52YXMuZmlsbFJlY3QoMCwgMCwgQGdldFdpZHRoKCksIEBnZXRXaWR0aCgpKVxuICAgIGZvciB5IGluIFswLi4udGlsZW1hcC5oZWlnaHRdIHRoZW4gZm9yIHggaW4gWzAuLi50aWxlbWFwLndpZHRoXVxuICAgICAgc3dpdGNoIHRpbGVtYXBbeF1beV1cbiAgICAgICAgd2hlbiBUaWxlLkdST1VORCB0aGVuIEBkcmF3VGlsZSh4LCB5LCB0aWxlU2l6ZSwgQ29sb3IuR1JPVU5EKVxuICAgICAgICB3aGVuIFRpbGUuV0FMTFxuICAgICAgICAgIGlmIHdhbGxbc2hvd1dhbGxzXSBpcyAnVElMRSdcbiAgICAgICAgICAgIEBkcmF3VGlsZSh4LCB5LCB0aWxlU2l6ZSwgQ29sb3IuV0FMTClcbiAgICAgICAgICBlbHNlIGlmIHdhbGxbc2hvd1dhbGxzXSBpcyAnQ09NUE9TRUQnXG4gICAgICAgICAgICBAZHJhd1dhbGwoeCwgeSwgdGlsZVNpemUsIENvbG9yLldBTEwsIHRpbGVtYXApXG4gICAgICAgIHdoZW4gVGlsZS5ET09SIHRoZW4gQGRyYXdUaWxlKHgsIHksIHRpbGVTaXplLCBDb2xvci5ET09SKVxuICAgIEBkcmF3R3JpZCh0aWxlbWFwKSBpZiBkcmF3R3JpZFxuXG4gIGRyYXdUaWxlOiAoeCwgeSwgc2l6ZSwgdmFsdWUpIC0+XG4gICAgQGNhbnZhcy5maWxsU3R5bGUgPSB2YWx1ZVxuICAgIEBjYW52YXMuZmlsbFJlY3QoeCAqIHNpemUsIHkgKiBzaXplLCBzaXplLCBzaXplKVxuXG4gIGRyYXdXYWxsOiAoeCwgeSwgc2l6ZSwgdmFsdWUsIHRpbGVtYXApIC0+XG4gICAgZmxhZ3MgPVxuICAgICAgbm9ydGg6IG5vdCB0aWxlbWFwLmlzKHgsIHkgLSAxLCAxLCAxLCBUaWxlLkVNUFRZKSBhbmRcbiAgICAgICAgICAgICBub3QgdGlsZW1hcC5pcyh4LCB5IC0gMSwgMSwgMSwgVGlsZS5XQUxMKSBhbmQgeSA+IDFcbiAgICAgIHNvdXRoOiBub3QgdGlsZW1hcC5pcyh4LCB5ICsgMSwgMSwgMSwgVGlsZS5FTVBUWSkgYW5kXG4gICAgICAgICAgICAgbm90IHRpbGVtYXAuaXMoeCwgeSArIDEsIDEsIDEsIFRpbGUuV0FMTClhbmQgeSA8IHRpbGVtYXAuaGVpZ2h0IC0gMVxuICAgICAgZWFzdDogbm90IHRpbGVtYXAuaXMoeCArIDEsIHksIDEsIDEsIFRpbGUuRU1QVFkpIGFuZFxuICAgICAgICAgICAgbm90IHRpbGVtYXAuaXMoeCArIDEsIHksIDEsIDEsIFRpbGUuV0FMTCkgYW5kIHggPCB0aWxlbWFwLndpZHRoIC0gMVxuICAgICAgd2VzdDogbm90IHRpbGVtYXAuaXMoeCAtIDEsIHksIDEsIDEsIFRpbGUuRU1QVFkpIGFuZFxuICAgICAgICAgICAgbm90IHRpbGVtYXAuaXMoeCAtIDEsIHksIDEsIDEsIFRpbGUuV0FMTCkgYW5kIHggPiAxXG4gICAgICBub3J0aHdlc3Q6IG5vdCB0aWxlbWFwLmlzKHggLSAxLCB5IC0gMSwgMSwgMSwgVGlsZS5FTVBUWSkgYW5kXG4gICAgICAgICAgICAgICAgIG5vdCB0aWxlbWFwLmlzKHggLSAxLCB5IC0gMSwgMSwgMSwgVGlsZS5XQUxMKSBhbmRcbiAgICAgICAgICAgICAgICAgeSA+IDEgYW5kIHggPiAxXG4gICAgICBub3J0aGVhc3Q6IG5vdCB0aWxlbWFwLmlzKHggKyAxLCB5IC0gMSwgMSwgMSwgVGlsZS5FTVBUWSkgYW5kXG4gICAgICAgICAgICAgICAgIG5vdCB0aWxlbWFwLmlzKHggKyAxLCB5IC0gMSwgMSwgMSwgVGlsZS5XQUxMKSBhbmRcbiAgICAgICAgICAgICAgICAgeSA+IDEgYW5kIHggPCB0aWxlbWFwLndpZHRoIC0gMVxuICAgICAgc291dGh3ZXN0OiBub3QgdGlsZW1hcC5pcyh4IC0gMSwgeSArIDEsIDEsIDEsIFRpbGUuRU1QVFkpIGFuZFxuICAgICAgICAgICAgICAgICBub3QgdGlsZW1hcC5pcyh4IC0gMSwgeSArIDEsIDEsIDEsIFRpbGUuV0FMTCkgYW5kXG4gICAgICAgICAgICAgICAgIHkgPCB0aWxlbWFwLmhlaWdodCAtIDEgYW5kIHggPiAxXG4gICAgICBzb3V0aGVhc3Q6IG5vdCB0aWxlbWFwLmlzKHggKyAxLCB5ICsgMSwgMSwgMSwgVGlsZS5FTVBUWSkgYW5kXG4gICAgICAgICAgICAgICAgIG5vdCB0aWxlbWFwLmlzKHggKyAxLCB5ICsgMSwgMSwgMSwgVGlsZS5XQUxMKSBhbmRcbiAgICAgICAgICAgICAgICAgeSA8IHRpbGVtYXAuaGVpZ2h0IC0gMSBhbmQgeCA8IHRpbGVtYXAud2lkdGggLSAxXG4gICAgd2FsbFNpemUgPSBAY2FsY3VsYXRlV2FsbFNpemUoc2l6ZSlcbiAgICBAY2FudmFzLmZpbGxTdHlsZSA9IHZhbHVlXG4gICAgQGNhbnZhcy5maWxsUmVjdCh4KnNpemUsIHkqc2l6ZSwgc2l6ZSwgd2FsbFNpemUpIGlmIGZsYWdzLm5vcnRoXG4gICAgQGNhbnZhcy5maWxsUmVjdCh4KnNpemUsICh5KzEpKnNpemUtd2FsbFNpemUsIHNpemUsIHdhbGxTaXplKSBpZiBmbGFncy5zb3V0aFxuICAgIEBjYW52YXMuZmlsbFJlY3QoKHgrMSkqc2l6ZS13YWxsU2l6ZSwgeSpzaXplLCB3YWxsU2l6ZSwgc2l6ZSkgaWYgZmxhZ3MuZWFzdFxuICAgIEBjYW52YXMuZmlsbFJlY3QoeCpzaXplLCB5KnNpemUsIHdhbGxTaXplLCBzaXplKSBpZiBmbGFncy53ZXN0XG4gICAgQGNhbnZhcy5maWxsUmVjdCh4KnNpemUsIHkqc2l6ZSwgd2FsbFNpemUsIHdhbGxTaXplKSBpZiBmbGFncy5ub3J0aHdlc3RcbiAgICBAY2FudmFzLmZpbGxSZWN0KCh4KzEpKnNpemUtd2FsbFNpemUsIHkqc2l6ZSxcbiAgICAgICAgd2FsbFNpemUsIHdhbGxTaXplKSBpZiBmbGFncy5ub3J0aGVhc3RcbiAgICBAY2FudmFzLmZpbGxSZWN0KCh4KzEpKnNpemUtd2FsbFNpemUsICh5KzEpKnNpemUtd2FsbFNpemUsXG4gICAgICAgIHdhbGxTaXplLCB3YWxsU2l6ZSkgaWYgZmxhZ3Muc291dGhlYXN0XG4gICAgQGNhbnZhcy5maWxsUmVjdCh4ICogc2l6ZSwgKHkgKyAxKSAqIHNpemUgLSB3YWxsU2l6ZSxcbiAgICAgICAgd2FsbFNpemUsIHdhbGxTaXplKSBpZiBmbGFncy5zb3V0aHdlc3RcblxuICBkcmF3R3JpZDogKHRpbGVtYXApIC0+XG4gICAgdGlsZVNpemUgPSBAY2FsY3VsYXRlVGlsZVNpemUodGlsZW1hcC53aWR0aClcbiAgICBAY2FudmFzLmJlZ2luUGF0aCgpXG4gICAgQGNhbnZhcy5zdHJva2VTdHlsZSA9IENvbG9yLkdSSURcbiAgICBmb3IgeCBpbiBbMC4udGlsZW1hcC53aWR0aF0gICMgV2UgYXNzdW1lIHRpbGVtYXAgdG8gYmUgc3F1YXJlZFxuICAgICAgQGNhbnZhcy5tb3ZlVG8oeCAqIHRpbGVTaXplLCAwKVxuICAgICAgQGNhbnZhcy5saW5lVG8oeCAqIHRpbGVTaXplLCB0aWxlbWFwLndpZHRoICogdGlsZVNpemUpXG4gICAgICBAY2FudmFzLm1vdmVUbygwLCB4ICogdGlsZVNpemUpXG4gICAgICBAY2FudmFzLmxpbmVUbyh0aWxlbWFwLndpZHRoICogdGlsZVNpemUsIHggKiB0aWxlU2l6ZSlcbiAgICBAY2FudmFzLmxpbmVXaWR0aCA9IEBjYWxjdWxhdGVHcmlkV2lkdGgodGlsZVNpemUpXG4gICAgQGNhbnZhcy5zdHJva2UoKVxuICAgIEBjYW52YXMuY2xvc2VQYXRoKClcblxuIyBNYWtlIENhbnZhc0NvbnRyb2xsZXIgYXZhaWxhYmxlIGdsb2JhbGx5XG50aGlzLkNhbnZhc0NvbnRyb2xsZXIgPSBDYW52YXNDb250cm9sbGVyXG50aGlzLndhbGxTdHlsZSA9IHdhbGxcbiJdfQ==