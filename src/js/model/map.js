var Direction, Map, Room, Tile;

Tile = {
  EMPTY: 0,
  OCCUPIED: 1,
  GROUND: 1,
  WALL: -1,
  DOOR: -2,
  FIRST_ROOM: 2,
  TREASURE_ROOM: 3,
  SECRET_ROOM: 4
};

Direction = {
  NORTH: 0,
  EAST: 1,
  SOUTH: 2,
  WEST: 3
};


/*
  This class represents a room in the map. The rom is defined by a point in a
  2D space (representing its upper-left corner), its width and its height. It
  is also linked to its neighbours, so it can be treated as a node in a graph.
 */

Room = (function() {
  function Room(x, y, width, height, neighbours, id, special, state) {
    var i;
    if (state == null) {
      state = 'open';
    }
    this.origin = new Point(x, y);
    this.p2 = new Point(x + width - 1, y + height - 1);
    this.state = 'open';
    this.special = special;
    this.width = width;
    this.height = height;
    this.id = id;
    this.neighbours = neighbours != null ? neighbours : (function() {
      var j, results;
      results = [];
      for (i = j = 0; j < 8; i = ++j) {
        results.push(null);
      }
      return results;
    })();
  }

  Room.prototype.getExits = function() {
    var i;
    return [].push((function() {
      var j, ref, results;
      results = [];
      for (i = j = 0, ref = this.width; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
        results.push((Direction.NORTH + (i * 4), Direction.SOUTH + (i * 4)));
      }
      return results;
    }).call(this), (function() {
      var j, ref, results;
      results = [];
      for (i = j = 0, ref = this.height; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
        results.push((Direction.EAST + (i * 4), Direction.WEST + (i * 4)));
      }
      return results;
    }).call(this));
  };

  Room.prototype.hasExit = function(exit) {
    return ((exit % 4 === Direction.NORTH || exit % 4 === Direction.SOUTH) && Math.floor(exit / 4) < this.width) || ((exit % 4 === Direction.EAST || exit % 4 === Direction.WEST) && Math.floor(exit / 4) < this.height);
  };

  Room.prototype.getAvailableExits = function() {
    var door, j, len, neighbour, ref, results;
    ref = this.neighbours;
    results = [];
    for (door = j = 0, len = ref.length; j < len; door = ++j) {
      neighbour = ref[door];
      if (this.hasExit(door) && (neighbour == null)) {
        results.push(door);
      }
    }
    return results;
  };

  Room.prototype.clone = function() {
    var n;
    return new Room(this.origin[0], this.origin[1], this.width, this.height, (function() {
      var j, len, ref, results;
      ref = this.neighbours;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        n = ref[j];
        results.push(n);
      }
      return results;
    }).call(this), this.id, this.special, this.state);
  };

  Room.prototype.isContainedIn = function(array) {
    var item, j, len;
    for (j = 0, len = array.length; j < len; j++) {
      item = array[j];
      if (item.origin[0] === this.origin[0] && item.origin[1] === this.origin[1] && item.width === this.width && item.height === this.height) {
        return true;
      }
    }
    return false;
  };

  return Room;

})();


/*
  This class represents the hole map. It is defined by a height, a width and
  a list of rooms.
 */

Map = (function() {
  var paintRoom;

  function Map(width1, height1, roomList) {
    this.width = width1;
    this.height = height1;
    this.roomList = roomList;
  }

  Map.prototype.getTilemap = function(tilesPerUnit) {
    var i, j, len, ref, room, tilemap;
    tilesPerUnit++;
    tilemap = new Tilemap((this.width * tilesPerUnit) + 1, (this.height * tilesPerUnit) + 1, Tile.EMPTY);
    ref = this.roomList;
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      room = ref[i];
      paintRoom(room, tilemap, tilesPerUnit);
    }
    return tilemap;
  };

  paintRoom = function(room, tilemap, tilesPerUnit) {
    var door, doorOffset, height, j, len, neighbour, origin, ref, results, width;
    origin = new Point(room.origin[0] * tilesPerUnit, room.origin[1] * tilesPerUnit);
    width = room.width * tilesPerUnit;
    height = room.height * tilesPerUnit;
    if (room.special === 'first room') {
      tilemap.set(origin[0] + 1, origin[1] + 1, width, height, Tile.FIRST_ROOM);
    } else if (room.special === 'treasure room') {
      tilemap.set(origin[0] + 1, origin[1] + 1, width, height, Tile.TREASURE_ROOM);
    } else if (room.special === 'secret room') {
      tilemap.set(origin[0] + 1, origin[1] + 1, width, height, Tile.SECRET_ROOM);
    } else {
      tilemap.set(origin[0] + 1, origin[1] + 1, width, height, Tile.GROUND);
    }
    tilemap.set(origin[0], origin[1], width + 1, 1, Tile.WALL);
    tilemap.set(origin[0], origin[1] + height, width + 1, 1, Tile.WALL);
    tilemap.set(origin[0] + width, origin[1], 1, height + 1, Tile.WALL);
    tilemap.set(origin[0], origin[1], 1, height + 1, Tile.WALL);
    ref = room.neighbours;
    results = [];
    for (door = j = 0, len = ref.length; j < len; door = ++j) {
      neighbour = ref[door];
      if (!(neighbour != null)) {
        continue;
      }
      doorOffset = ((Math.floor(door / 4)) * tilesPerUnit) + (Math.floor(tilesPerUnit / 2));
      switch (door % 4) {
        case Direction.NORTH:
          results.push(tilemap[origin[0] + doorOffset][origin[1]] = Tile.DOOR);
          break;
        case Direction.SOUTH:
          results.push(tilemap[origin[0] + doorOffset][origin[1] + height] = Tile.DOOR);
          break;
        case Direction.EAST:
          results.push(tilemap[origin[0] + width][origin[1] + doorOffset] = Tile.DOOR);
          break;
        case Direction.WEST:
          results.push(tilemap[origin[0]][origin[1] + doorOffset] = Tile.DOOR);
          break;
        default:
          results.push(void 0);
      }
    }
    return results;
  };

  return Map;

})();

this.Direction = Direction;

this.Tile = Tile;

this.Room = Room;

this.Map = Map;

//# sourceMappingURL=data:application/json;base64,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RHhEO0FBSFAsYUFLTyxTQUFTLENBQUMsSUFMakI7dUJBTUksT0FBUSxDQUFBLE1BQU8sQ0FBQSxDQUFBLENBQVAsR0FBWSxLQUFaLENBQW1CLENBQUEsTUFBTyxDQUFBLENBQUEsQ0FBUCxHQUFZLFVBQVosQ0FBM0IsR0FBcUQsSUFBSSxDQUFDO0FBRHZEO0FBTFAsYUFPTyxTQUFTLENBQUMsSUFQakI7dUJBUUksT0FBUSxDQUFBLE1BQU8sQ0FBQSxDQUFBLENBQVAsQ0FBVyxDQUFBLE1BQU8sQ0FBQSxDQUFBLENBQVAsR0FBWSxVQUFaLENBQW5CLEdBQTZDLElBQUksQ0FBQztBQUQvQztBQVBQOztBQUFBO0FBRkY7O0VBbkJVOzs7Ozs7QUFpQ2QsSUFBSSxDQUFDLFNBQUwsR0FBaUI7O0FBQ2pCLElBQUksQ0FBQyxJQUFMLEdBQVk7O0FBQ1osSUFBSSxDQUFDLElBQUwsR0FBWTs7QUFDWixJQUFJLENBQUMsR0FBTCxHQUFZIiwiZmlsZSI6Im1vZGVsL21hcC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiMgIFRoaXMgZmlsZSBjb250YWlucyBzb21lIGNsYXNzZXMgYW5kIHV0aWxpdGllcyB0byB3b3JrIHdpdGggcm9vbXMgYW5kIG1hcHNcclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuIyAgQXV0aG9yOiBBZHJpYW4gTW9yZW5vXHJcbiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5UaWxlID1cclxuICBFTVBUWSAgICA6IDBcclxuICBPQ0NVUElFRCA6IDFcclxuICBHUk9VTkQ6IDFcclxuICBXQUxMOiAtMVxyXG4gIERPT1I6IC0yXHJcbiAgRklSU1RfUk9PTTogMlxyXG4gIFRSRUFTVVJFX1JPT006IDNcclxuICBTRUNSRVRfUk9PTTogNFxyXG5cclxuRGlyZWN0aW9uID1cclxuICBOT1JUSCA6IDBcclxuICBFQVNUICA6IDFcclxuICBTT1VUSCA6IDJcclxuICBXRVNUICA6IDNcclxuXHJcblxyXG4jIyNcclxuICBUaGlzIGNsYXNzIHJlcHJlc2VudHMgYSByb29tIGluIHRoZSBtYXAuIFRoZSByb20gaXMgZGVmaW5lZCBieSBhIHBvaW50IGluIGFcclxuICAyRCBzcGFjZSAocmVwcmVzZW50aW5nIGl0cyB1cHBlci1sZWZ0IGNvcm5lciksIGl0cyB3aWR0aCBhbmQgaXRzIGhlaWdodC4gSXRcclxuICBpcyBhbHNvIGxpbmtlZCB0byBpdHMgbmVpZ2hib3Vycywgc28gaXQgY2FuIGJlIHRyZWF0ZWQgYXMgYSBub2RlIGluIGEgZ3JhcGguXHJcbiMjI1xyXG5cclxuY2xhc3MgUm9vbVxyXG5cclxuICBjb25zdHJ1Y3RvcjogKHgsIHksIHdpZHRoLCBoZWlnaHQsIG5laWdoYm91cnMsIGlkLCBzcGVjaWFsLCBzdGF0ZSA9ICdvcGVuJykgLT5cclxuICAgIHRoaXMub3JpZ2luID0gbmV3IFBvaW50KHgsIHkpXHJcbiAgICB0aGlzLnAyID0gbmV3IFBvaW50KHggKyB3aWR0aCAtIDEsIHkgKyBoZWlnaHQgLSAxKVxyXG4gICAgdGhpcy5zdGF0ZSA9ICdvcGVuJ1xyXG4gICAgdGhpcy5zcGVjaWFsID0gc3BlY2lhbFxyXG4gICAgdGhpcy53aWR0aCA9IHdpZHRoXHJcbiAgICB0aGlzLmhlaWdodCA9IGhlaWdodFxyXG4gICAgdGhpcy5pZCA9IGlkXHJcbiAgICAjIElmIG5vIG5laWdoYm91cnMgYXJlIHByb3ZpZGVkLCBpbml0aWFsaXplIHRoZSBhcnJheSB3aXRoIG51bGwgb2JqZWN0c1xyXG4gICAgdGhpcy5uZWlnaGJvdXJzID0gbmVpZ2hib3VycyA/ICggbnVsbCBmb3IgaSBpbiBbMC4uLjhdIClcclxuXHJcbiAgZ2V0RXhpdHM6ICgpIC0+XHJcbiAgICBbXS5wdXNoKFxyXG4gICAgICAoZm9yIGkgaW4gWzAuLi50aGlzLndpZHRoXVxyXG4gICAgICAgIChEaXJlY3Rpb24uTk9SVEggKyAoaSo0KTsgRGlyZWN0aW9uLlNPVVRIICsgKGkqNCkpKSxcclxuICAgICAgKGZvciBpIGluIFswLi50aGlzLmhlaWdodF1cclxuICAgICAgICAoRGlyZWN0aW9uLkVBU1QgKyAoaSo0KTsgRGlyZWN0aW9uLldFU1QgKyAoaSo0KSkpXHJcbiAgICApXHJcblxyXG4gIGhhc0V4aXQ6IChleGl0KSAtPlxyXG4gICAgKChleGl0ICUgNCBpcyBEaXJlY3Rpb24uTk9SVEggb3IgZXhpdCAlIDQgaXMgRGlyZWN0aW9uLlNPVVRIKSBhbmRcclxuICAgICAgZXhpdCAvLyA0IDwgdGhpcy53aWR0aCkgb3JcclxuICAgICgoZXhpdCAlIDQgaXMgRGlyZWN0aW9uLkVBU1Qgb3IgZXhpdCAlIDQgaXMgRGlyZWN0aW9uLldFU1QpIGFuZFxyXG4gICAgICBleGl0IC8vIDQgPCB0aGlzLmhlaWdodClcclxuXHJcbiAgZ2V0QXZhaWxhYmxlRXhpdHM6ICgpIC0+XHJcbiAgICAjIFJldHVybiBhbiBhcnJheSB3aXRoIHRoZSBpbmRleGVzIG9mIHVudXNlZCBleGl0cyBvZiB0aGUgcm9vbVxyXG4gICAgZG9vciBmb3IgbmVpZ2hib3VyLCBkb29yIGluIHRoaXMubmVpZ2hib3VycyB3aGVuIHRoaXMuaGFzRXhpdChkb29yKSBhbmRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3QgbmVpZ2hib3VyP1xyXG5cclxuICBjbG9uZTogKCkgLT4gbmV3IFJvb20oXHJcbiAgICAgIEBvcmlnaW5bMF0sIEBvcmlnaW5bMV0sIEB3aWR0aCwgQGhlaWdodCwgKG4gZm9yIG4gaW4gdGhpcy5uZWlnaGJvdXJzKSxcclxuICAgICAgQGlkLCBAc3BlY2lhbCwgQHN0YXRlXHJcbiAgICApXHJcblxyXG4gIGlzQ29udGFpbmVkSW46IChhcnJheSkgLT5cclxuICAgIGZvciBpdGVtIGluIGFycmF5XHJcbiAgICAgIHJldHVybiB0cnVlIGlmIGl0ZW0ub3JpZ2luWzBdIGlzIHRoaXMub3JpZ2luWzBdIGFuZFxyXG4gICAgICAgICAgICAgICAgICAgICBpdGVtLm9yaWdpblsxXSBpcyB0aGlzLm9yaWdpblsxXSBhbmRcclxuICAgICAgICAgICAgICAgICAgICAgaXRlbS53aWR0aCBpcyB0aGlzLndpZHRoIGFuZCBpdGVtLmhlaWdodCBpcyB0aGlzLmhlaWdodFxyXG4gICAgcmV0dXJuIGZhbHNlXHJcblxyXG5cclxuIyMjXHJcbiAgVGhpcyBjbGFzcyByZXByZXNlbnRzIHRoZSBob2xlIG1hcC4gSXQgaXMgZGVmaW5lZCBieSBhIGhlaWdodCwgYSB3aWR0aCBhbmRcclxuICBhIGxpc3Qgb2Ygcm9vbXMuXHJcbiMjI1xyXG5cclxuY2xhc3MgTWFwXHJcblxyXG4gIGNvbnN0cnVjdG9yOiAoQHdpZHRoLCBAaGVpZ2h0LCBAcm9vbUxpc3QpIC0+XHJcblxyXG4gIGdldFRpbGVtYXA6ICh0aWxlc1BlclVuaXQpIC0+XHJcbiAgICB0aWxlc1BlclVuaXQrKyAgIyBMZWF2ZSBzcGFjZSBmb3Igd2FsbHNcclxuICAgIHRpbGVtYXAgPSBuZXcgVGlsZW1hcChcclxuICAgICAgKHRoaXMud2lkdGggKiB0aWxlc1BlclVuaXQpICsgMSxcclxuICAgICAgKHRoaXMuaGVpZ2h0ICogdGlsZXNQZXJVbml0KSArIDEsXHJcbiAgICAgIFRpbGUuRU1QVFlcclxuICAgIClcclxuICAgIHBhaW50Um9vbShyb29tLCB0aWxlbWFwLCB0aWxlc1BlclVuaXQpIGZvciByb29tLCBpIGluIHRoaXMucm9vbUxpc3RcclxuICAgIHJldHVybiB0aWxlbWFwXHJcblxyXG4gICMgUHJpdmF0ZSBoZWxwZXJcclxuICBwYWludFJvb20gPSAocm9vbSwgdGlsZW1hcCwgdGlsZXNQZXJVbml0KSAtPlxyXG4gICAgIyBDb252ZXJ0IGRpbWVuc2lvbnMgYW5kIGNvb3JkaW5hdGVzXHJcbiAgICBvcmlnaW4gPSBuZXcgUG9pbnQocm9vbS5vcmlnaW5bMF0qdGlsZXNQZXJVbml0LCByb29tLm9yaWdpblsxXSp0aWxlc1BlclVuaXQpXHJcbiAgICB3aWR0aCA9IHJvb20ud2lkdGggKiB0aWxlc1BlclVuaXRcclxuICAgIGhlaWdodCA9IHJvb20uaGVpZ2h0ICogdGlsZXNQZXJVbml0XHJcbiAgICAjIFBhaW50IGZsb29yXHJcbiAgICBpZiByb29tLnNwZWNpYWwgaXMgJ2ZpcnN0IHJvb20nXHJcbiAgICAgIHRpbGVtYXAuc2V0KG9yaWdpblswXSArIDEsIG9yaWdpblsxXSArIDEsIHdpZHRoLCBoZWlnaHQsIFRpbGUuRklSU1RfUk9PTSlcclxuICAgIGVsc2UgaWYgcm9vbS5zcGVjaWFsIGlzICd0cmVhc3VyZSByb29tJ1xyXG4gICAgICB0aWxlbWFwLnNldChvcmlnaW5bMF0gKyAxLCBvcmlnaW5bMV0gKyAxLCB3aWR0aCwgaGVpZ2h0LCBUaWxlLlRSRUFTVVJFX1JPT00pXHJcbiAgICBlbHNlIGlmIHJvb20uc3BlY2lhbCBpcyAnc2VjcmV0IHJvb20nXHJcbiAgICAgIHRpbGVtYXAuc2V0KG9yaWdpblswXSArIDEsIG9yaWdpblsxXSArIDEsIHdpZHRoLCBoZWlnaHQsIFRpbGUuU0VDUkVUX1JPT00pXHJcbiAgICBlbHNlIHRpbGVtYXAuc2V0KG9yaWdpblswXSArIDEsIG9yaWdpblsxXSArIDEsIHdpZHRoLCBoZWlnaHQsIFRpbGUuR1JPVU5EKVxyXG4gICAgIyBQYWludCB3YWxsc1xyXG4gICAgdGlsZW1hcC5zZXQob3JpZ2luWzBdLCBvcmlnaW5bMV0sIHdpZHRoICsgMSwgMSwgVGlsZS5XQUxMKSAgICAgICAgICAjIE5vcnRoXHJcbiAgICB0aWxlbWFwLnNldChvcmlnaW5bMF0sIG9yaWdpblsxXSArIGhlaWdodCwgd2lkdGggKyAxLCAxLCBUaWxlLldBTEwpICMgU291dGhcclxuICAgIHRpbGVtYXAuc2V0KG9yaWdpblswXSArIHdpZHRoLCBvcmlnaW5bMV0sIDEsIGhlaWdodCArIDEsIFRpbGUuV0FMTCkgIyBFYXN0XHJcbiAgICB0aWxlbWFwLnNldChvcmlnaW5bMF0sIG9yaWdpblsxXSwgMSwgaGVpZ2h0ICsgMSwgVGlsZS5XQUxMKSAgICAgICAgICMgV2VzdFxyXG4gICAgIyBQYWludCBkb29yc1xyXG4gICAgZm9yIG5laWdoYm91ciwgZG9vciBpbiByb29tLm5laWdoYm91cnMgd2hlbiBuZWlnaGJvdXI/XHJcbiAgICAgIGRvb3JPZmZzZXQgPSAoKGRvb3IgLy8gNCkgKiB0aWxlc1BlclVuaXQpICsgKHRpbGVzUGVyVW5pdCAvLyAyKVxyXG4gICAgICBzd2l0Y2ggKGRvb3IgJSA0KVxyXG4gICAgICAgIHdoZW4gRGlyZWN0aW9uLk5PUlRIXHJcbiAgICAgICAgICB0aWxlbWFwW29yaWdpblswXSArIGRvb3JPZmZzZXRdW29yaWdpblsxXV0gPSBUaWxlLkRPT1JcclxuICAgICAgICB3aGVuIERpcmVjdGlvbi5TT1VUSFxyXG4gICAgICAgICAgdGlsZW1hcFtvcmlnaW5bMF0gKyBkb29yT2Zmc2V0XVtvcmlnaW5bMV0gKyBoZWlnaHRdID0gVGlsZS5ET09SXHJcbiAgICAgICAgd2hlbiBEaXJlY3Rpb24uRUFTVFxyXG4gICAgICAgICAgdGlsZW1hcFtvcmlnaW5bMF0gKyB3aWR0aF1bb3JpZ2luWzFdICsgZG9vck9mZnNldF0gPSBUaWxlLkRPT1JcclxuICAgICAgICB3aGVuIERpcmVjdGlvbi5XRVNUXHJcbiAgICAgICAgICB0aWxlbWFwW29yaWdpblswXV1bb3JpZ2luWzFdICsgZG9vck9mZnNldF0gPSBUaWxlLkRPT1JcclxuXHJcblxyXG4jIE1ha2UgZWxlbWVudHMgYXZhaWxhYmxlIGdsb2JhbGx5XHJcbnRoaXMuRGlyZWN0aW9uID0gRGlyZWN0aW9uXHJcbnRoaXMuVGlsZSA9IFRpbGVcclxudGhpcy5Sb29tID0gUm9vbVxyXG50aGlzLk1hcCAgPSBNYXBcclxuIl19