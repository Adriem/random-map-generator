var Direction, Map, RoomX, Tile;

Tile = {
  EMPTY: 0,
  OCCUPIED: 1,
  GROUND: 1,
  WALL: -1,
  DOOR: -2,
  FIRST_ROOM: 2,
  TREASURE_ROOM: 3,
  SECRET_ROOM: 4
};

Direction = {
  NORTH: 0,
  EAST: 1,
  SOUTH: 2,
  WEST: 3
};


/*
  This class represents a room in the map. The rom is defined by a point in a
  2D space (representing its upper-left corner), its width and its height. It
  is also linked to its neighbours, so it can be treated as a node in a graph.
 */

RoomX = (function() {
  function RoomX(x, y, width, height, neighbours, id, special, state) {
    var i;
    if (state == null) {
      state = 'open';
    }
    this.origin = new Point(x, y);
    this.p2 = new Point(x + width - 1, y + height - 1);
    this.x = origin.x;
    this.y = origin.y;
    this.state = 'open';
    this.special = special;
    this.width = width;
    this.height = height;
    this.id = id;
    this.neighbours = neighbours != null ? neighbours : (function() {
      var j, results;
      results = [];
      for (i = j = 0; j < 8; i = ++j) {
        results.push(null);
      }
      return results;
    })();
  }

  RoomX.prototype.getExits = function() {
    var i;
    return [].push((function() {
      var j, ref, results;
      results = [];
      for (i = j = 0, ref = this.width; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
        results.push((Direction.NORTH + (i * 4), Direction.SOUTH + (i * 4)));
      }
      return results;
    }).call(this), (function() {
      var j, ref, results;
      results = [];
      for (i = j = 0, ref = this.height; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
        results.push((Direction.EAST + (i * 4), Direction.WEST + (i * 4)));
      }
      return results;
    }).call(this));
  };

  RoomX.prototype.hasExit = function(exit) {
    return ((exit % 4 === Direction.NORTH || exit % 4 === Direction.SOUTH) && Math.floor(exit / 4) < this.width) || ((exit % 4 === Direction.EAST || exit % 4 === Direction.WEST) && Math.floor(exit / 4) < this.height);
  };

  RoomX.prototype.getAvailableExits = function() {
    var door, j, len, neighbour, ref, results;
    ref = this.neighbours;
    results = [];
    for (door = j = 0, len = ref.length; j < len; door = ++j) {
      neighbour = ref[door];
      if (this.hasExit(door) && (neighbour == null)) {
        results.push(door);
      }
    }
    return results;
  };

  RoomX.prototype.clone = function() {
    var n;
    return new Room(this.origin[0], this.origin[1], this.width, this.height, (function() {
      var j, len, ref, results;
      ref = this.neighbours;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        n = ref[j];
        results.push(n);
      }
      return results;
    }).call(this), this.id, this.special, this.state);
  };

  RoomX.prototype.isContainedIn = function(array) {
    var item, j, len;
    for (j = 0, len = array.length; j < len; j++) {
      item = array[j];
      if (item.origin[0] === this.origin[0] && item.origin[1] === this.origin[1] && item.width === this.width && item.height === this.height) {
        return true;
      }
    }
    return false;
  };

  return RoomX;

})();


/*
  This class represents the hole map. It is defined by a height, a width and
  a list of rooms.
 */

Map = (function() {
  var paintRoom;

  function Map(width1, height1, roomList) {
    this.width = width1;
    this.height = height1;
    this.roomList = roomList;
  }

  Map.prototype.getTilemap = function(tilesPerUnit) {
    var i, j, len, ref, room, tilemap;
    tilesPerUnit++;
    tilemap = new Tilemap((this.width * tilesPerUnit) + 1, (this.height * tilesPerUnit) + 1, Tile.EMPTY);
    ref = this.roomList;
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      room = ref[i];
      paintRoom(room, tilemap, tilesPerUnit);
    }
    return tilemap;
  };

  paintRoom = function(room, tilemap, tilesPerUnit) {
    var door, doorOffset, height, j, len, neighbour, origin, ref, results, width;
    origin = new Point(room.x * tilesPerUnit, room.y * tilesPerUnit);
    width = room.width * tilesPerUnit;
    height = room.height * tilesPerUnit;
    if (room.special === 'first room') {
      tilemap.set(origin[0] + 1, origin[1] + 1, width, height, Tile.FIRST_ROOM);
    } else if (room.special === 'treasure room') {
      tilemap.set(origin[0] + 1, origin[1] + 1, width, height, Tile.TREASURE_ROOM);
    } else if (room.special === 'secret room') {
      tilemap.set(origin[0] + 1, origin[1] + 1, width, height, Tile.SECRET_ROOM);
    } else {
      tilemap.set(origin[0] + 1, origin[1] + 1, width, height, Tile.GROUND);
    }
    tilemap.set(origin[0], origin[1], width + 1, 1, Tile.WALL);
    tilemap.set(origin[0], origin[1] + height, width + 1, 1, Tile.WALL);
    tilemap.set(origin[0] + width, origin[1], 1, height + 1, Tile.WALL);
    tilemap.set(origin[0], origin[1], 1, height + 1, Tile.WALL);
    ref = room.neighbours;
    results = [];
    for (door = j = 0, len = ref.length; j < len; door = ++j) {
      neighbour = ref[door];
      if (!(neighbour != null)) {
        continue;
      }
      doorOffset = ((Math.floor(door / 4)) * tilesPerUnit) + (Math.floor(tilesPerUnit / 2));
      switch (door % 4) {
        case Direction.NORTH:
          results.push(tilemap[origin[0] + doorOffset][origin[1]] = Tile.DOOR);
          break;
        case Direction.SOUTH:
          results.push(tilemap[origin[0] + doorOffset][origin[1] + height] = Tile.DOOR);
          break;
        case Direction.EAST:
          results.push(tilemap[origin[0] + width][origin[1] + doorOffset] = Tile.DOOR);
          break;
        case Direction.WEST:
          results.push(tilemap[origin[0]][origin[1] + doorOffset] = Tile.DOOR);
          break;
        default:
          results.push(void 0);
      }
    }
    return results;
  };

  return Map;

})();

this.Direction = Direction;

this.Tile = Tile;

this.RoomX = Room;

this.Map = Map;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGVsL21hcC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUEsSUFBQTs7QUFBQSxJQUFBLEdBQ0U7RUFBQSxLQUFBLEVBQVcsQ0FBWDtFQUNBLFFBQUEsRUFBVyxDQURYO0VBRUEsTUFBQSxFQUFRLENBRlI7RUFHQSxJQUFBLEVBQU0sQ0FBQyxDQUhQO0VBSUEsSUFBQSxFQUFNLENBQUMsQ0FKUDtFQUtBLFVBQUEsRUFBWSxDQUxaO0VBTUEsYUFBQSxFQUFlLENBTmY7RUFPQSxXQUFBLEVBQWEsQ0FQYjs7O0FBU0YsU0FBQSxHQUNFO0VBQUEsS0FBQSxFQUFRLENBQVI7RUFDQSxJQUFBLEVBQVEsQ0FEUjtFQUVBLEtBQUEsRUFBUSxDQUZSO0VBR0EsSUFBQSxFQUFRLENBSFI7Ozs7QUFNRjs7Ozs7O0FBTU07RUFFUyxlQUFDLENBQUQsRUFBSSxDQUFKLEVBQU8sS0FBUCxFQUFjLE1BQWQsRUFBc0IsVUFBdEIsRUFBa0MsRUFBbEMsRUFBc0MsT0FBdEMsRUFBK0MsS0FBL0M7QUFDWCxRQUFBOztNQUQwRCxRQUFROztJQUNsRSxJQUFJLENBQUMsTUFBTCxHQUFrQixJQUFBLEtBQUEsQ0FBTSxDQUFOLEVBQVMsQ0FBVDtJQUNsQixJQUFJLENBQUMsRUFBTCxHQUFjLElBQUEsS0FBQSxDQUFNLENBQUEsR0FBSSxLQUFKLEdBQVksQ0FBbEIsRUFBcUIsQ0FBQSxHQUFJLE1BQUosR0FBYSxDQUFsQztJQUNkLElBQUksQ0FBQyxDQUFMLEdBQVMsTUFBTSxDQUFDO0lBQ2hCLElBQUksQ0FBQyxDQUFMLEdBQVMsTUFBTSxDQUFDO0lBQ2hCLElBQUksQ0FBQyxLQUFMLEdBQWE7SUFDYixJQUFJLENBQUMsT0FBTCxHQUFlO0lBQ2YsSUFBSSxDQUFDLEtBQUwsR0FBYTtJQUNiLElBQUksQ0FBQyxNQUFMLEdBQWM7SUFDZCxJQUFJLENBQUMsRUFBTCxHQUFVO0lBRVYsSUFBSSxDQUFDLFVBQUwsd0JBQWtCOztBQUFlO1dBQWMseUJBQWQ7cUJBQUE7QUFBQTs7O0VBWHRCOztrQkFhYixRQUFBLEdBQVUsU0FBQTtBQUNSLFFBQUE7V0FBQSxFQUFFLENBQUMsSUFBSDs7QUFDRztXQUFTLG1GQUFUO3FCQUNFLENBQUEsU0FBUyxDQUFDLEtBQVYsR0FBa0IsQ0FBQyxDQUFBLEdBQUUsQ0FBSCxDQUFsQixFQUF5QixTQUFTLENBQUMsS0FBVixHQUFrQixDQUFDLENBQUEsR0FBRSxDQUFILENBQTNDO0FBREY7O2lCQURIOztBQUdHO1dBQVMsc0ZBQVQ7cUJBQ0UsQ0FBQSxTQUFTLENBQUMsSUFBVixHQUFpQixDQUFDLENBQUEsR0FBRSxDQUFILENBQWpCLEVBQXdCLFNBQVMsQ0FBQyxJQUFWLEdBQWlCLENBQUMsQ0FBQSxHQUFFLENBQUgsQ0FBekM7QUFERjs7aUJBSEg7RUFEUTs7a0JBUVYsT0FBQSxHQUFTLFNBQUMsSUFBRDtXQUNQLENBQUMsQ0FBQyxJQUFBLEdBQU8sQ0FBUCxLQUFZLFNBQVMsQ0FBQyxLQUF0QixJQUErQixJQUFBLEdBQU8sQ0FBUCxLQUFZLFNBQVMsQ0FBQyxLQUF0RCxDQUFBLGVBQ0MsT0FBUSxFQUFSLEdBQVksSUFBSSxDQUFDLEtBRG5CLENBQUEsSUFFQSxDQUFDLENBQUMsSUFBQSxHQUFPLENBQVAsS0FBWSxTQUFTLENBQUMsSUFBdEIsSUFBOEIsSUFBQSxHQUFPLENBQVAsS0FBWSxTQUFTLENBQUMsSUFBckQsQ0FBQSxlQUNDLE9BQVEsRUFBUixHQUFZLElBQUksQ0FBQyxNQURuQjtFQUhPOztrQkFNVCxpQkFBQSxHQUFtQixTQUFBO0FBRWpCLFFBQUE7QUFBQTtBQUFBO1NBQUEsbURBQUE7O1VBQWlELElBQUksQ0FBQyxPQUFMLENBQWEsSUFBYixDQUFBLElBQ0k7cUJBRHJEOztBQUFBOztFQUZpQjs7a0JBS25CLEtBQUEsR0FBTyxTQUFBO0FBQU0sUUFBQTtXQUFJLElBQUEsSUFBQSxDQUNiLElBQUMsQ0FBQSxNQUFPLENBQUEsQ0FBQSxDQURLLEVBQ0QsSUFBQyxDQUFBLE1BQU8sQ0FBQSxDQUFBLENBRFAsRUFDVyxJQUFDLENBQUEsS0FEWixFQUNtQixJQUFDLENBQUEsTUFEcEI7O0FBQzZCO0FBQUE7V0FBQSxxQ0FBQTs7cUJBQUE7QUFBQTs7aUJBRDdCLEVBRWIsSUFBQyxDQUFBLEVBRlksRUFFUixJQUFDLENBQUEsT0FGTyxFQUVFLElBQUMsQ0FBQSxLQUZIO0VBQVY7O2tCQUtQLGFBQUEsR0FBZSxTQUFDLEtBQUQ7QUFDYixRQUFBO0FBQUEsU0FBQSx1Q0FBQTs7TUFDRSxJQUFlLElBQUksQ0FBQyxNQUFPLENBQUEsQ0FBQSxDQUFaLEtBQWtCLElBQUksQ0FBQyxNQUFPLENBQUEsQ0FBQSxDQUE5QixJQUNBLElBQUksQ0FBQyxNQUFPLENBQUEsQ0FBQSxDQUFaLEtBQWtCLElBQUksQ0FBQyxNQUFPLENBQUEsQ0FBQSxDQUQ5QixJQUVBLElBQUksQ0FBQyxLQUFMLEtBQWMsSUFBSSxDQUFDLEtBRm5CLElBRTZCLElBQUksQ0FBQyxNQUFMLEtBQWUsSUFBSSxDQUFDLE1BRmhFO0FBQUEsZUFBTyxLQUFQOztBQURGO0FBSUEsV0FBTztFQUxNOzs7Ozs7O0FBUWpCOzs7OztBQUtNO0FBRUosTUFBQTs7RUFBYSxhQUFDLE1BQUQsRUFBUyxPQUFULEVBQWtCLFFBQWxCO0lBQUMsSUFBQyxDQUFBLFFBQUQ7SUFBUSxJQUFDLENBQUEsU0FBRDtJQUFTLElBQUMsQ0FBQSxXQUFEO0VBQWxCOztnQkFFYixVQUFBLEdBQVksU0FBQyxZQUFEO0FBQ1YsUUFBQTtJQUFBLFlBQUE7SUFDQSxPQUFBLEdBQWMsSUFBQSxPQUFBLENBQ1osQ0FBQyxJQUFJLENBQUMsS0FBTCxHQUFhLFlBQWQsQ0FBQSxHQUE4QixDQURsQixFQUVaLENBQUMsSUFBSSxDQUFDLE1BQUwsR0FBYyxZQUFmLENBQUEsR0FBK0IsQ0FGbkIsRUFHWixJQUFJLENBQUMsS0FITztBQUtkO0FBQUEsU0FBQSw2Q0FBQTs7TUFBQSxTQUFBLENBQVUsSUFBVixFQUFnQixPQUFoQixFQUF5QixZQUF6QjtBQUFBO0FBQ0EsV0FBTztFQVJHOztFQVdaLFNBQUEsR0FBWSxTQUFDLElBQUQsRUFBTyxPQUFQLEVBQWdCLFlBQWhCO0FBRVYsUUFBQTtJQUFBLE1BQUEsR0FBYSxJQUFBLEtBQUEsQ0FBTSxJQUFJLENBQUMsQ0FBTCxHQUFPLFlBQWIsRUFBMkIsSUFBSSxDQUFDLENBQUwsR0FBTyxZQUFsQztJQUNiLEtBQUEsR0FBUSxJQUFJLENBQUMsS0FBTCxHQUFhO0lBQ3JCLE1BQUEsR0FBUyxJQUFJLENBQUMsTUFBTCxHQUFjO0lBRXZCLElBQUcsSUFBSSxDQUFDLE9BQUwsS0FBZ0IsWUFBbkI7TUFDRSxPQUFPLENBQUMsR0FBUixDQUFZLE1BQU8sQ0FBQSxDQUFBLENBQVAsR0FBWSxDQUF4QixFQUEyQixNQUFPLENBQUEsQ0FBQSxDQUFQLEdBQVksQ0FBdkMsRUFBMEMsS0FBMUMsRUFBaUQsTUFBakQsRUFBeUQsSUFBSSxDQUFDLFVBQTlELEVBREY7S0FBQSxNQUVLLElBQUcsSUFBSSxDQUFDLE9BQUwsS0FBZ0IsZUFBbkI7TUFDSCxPQUFPLENBQUMsR0FBUixDQUFZLE1BQU8sQ0FBQSxDQUFBLENBQVAsR0FBWSxDQUF4QixFQUEyQixNQUFPLENBQUEsQ0FBQSxDQUFQLEdBQVksQ0FBdkMsRUFBMEMsS0FBMUMsRUFBaUQsTUFBakQsRUFBeUQsSUFBSSxDQUFDLGFBQTlELEVBREc7S0FBQSxNQUVBLElBQUcsSUFBSSxDQUFDLE9BQUwsS0FBZ0IsYUFBbkI7TUFDSCxPQUFPLENBQUMsR0FBUixDQUFZLE1BQU8sQ0FBQSxDQUFBLENBQVAsR0FBWSxDQUF4QixFQUEyQixNQUFPLENBQUEsQ0FBQSxDQUFQLEdBQVksQ0FBdkMsRUFBMEMsS0FBMUMsRUFBaUQsTUFBakQsRUFBeUQsSUFBSSxDQUFDLFdBQTlELEVBREc7S0FBQSxNQUFBO01BRUEsT0FBTyxDQUFDLEdBQVIsQ0FBWSxNQUFPLENBQUEsQ0FBQSxDQUFQLEdBQVksQ0FBeEIsRUFBMkIsTUFBTyxDQUFBLENBQUEsQ0FBUCxHQUFZLENBQXZDLEVBQTBDLEtBQTFDLEVBQWlELE1BQWpELEVBQXlELElBQUksQ0FBQyxNQUE5RCxFQUZBOztJQUlMLE9BQU8sQ0FBQyxHQUFSLENBQVksTUFBTyxDQUFBLENBQUEsQ0FBbkIsRUFBdUIsTUFBTyxDQUFBLENBQUEsQ0FBOUIsRUFBa0MsS0FBQSxHQUFRLENBQTFDLEVBQTZDLENBQTdDLEVBQWdELElBQUksQ0FBQyxJQUFyRDtJQUNBLE9BQU8sQ0FBQyxHQUFSLENBQVksTUFBTyxDQUFBLENBQUEsQ0FBbkIsRUFBdUIsTUFBTyxDQUFBLENBQUEsQ0FBUCxHQUFZLE1BQW5DLEVBQTJDLEtBQUEsR0FBUSxDQUFuRCxFQUFzRCxDQUF0RCxFQUF5RCxJQUFJLENBQUMsSUFBOUQ7SUFDQSxPQUFPLENBQUMsR0FBUixDQUFZLE1BQU8sQ0FBQSxDQUFBLENBQVAsR0FBWSxLQUF4QixFQUErQixNQUFPLENBQUEsQ0FBQSxDQUF0QyxFQUEwQyxDQUExQyxFQUE2QyxNQUFBLEdBQVMsQ0FBdEQsRUFBeUQsSUFBSSxDQUFDLElBQTlEO0lBQ0EsT0FBTyxDQUFDLEdBQVIsQ0FBWSxNQUFPLENBQUEsQ0FBQSxDQUFuQixFQUF1QixNQUFPLENBQUEsQ0FBQSxDQUE5QixFQUFrQyxDQUFsQyxFQUFxQyxNQUFBLEdBQVMsQ0FBOUMsRUFBaUQsSUFBSSxDQUFDLElBQXREO0FBRUE7QUFBQTtTQUFBLG1EQUFBOztZQUE0Qzs7O01BQzFDLFVBQUEsR0FBYSxDQUFDLFlBQUMsT0FBUSxFQUFULENBQUEsR0FBYyxZQUFmLENBQUEsR0FBK0IsWUFBQyxlQUFnQixFQUFqQjtBQUM1QyxjQUFRLElBQUEsR0FBTyxDQUFmO0FBQUEsYUFDTyxTQUFTLENBQUMsS0FEakI7dUJBRUksT0FBUSxDQUFBLE1BQU8sQ0FBQSxDQUFBLENBQVAsR0FBWSxVQUFaLENBQXdCLENBQUEsTUFBTyxDQUFBLENBQUEsQ0FBUCxDQUFoQyxHQUE2QyxJQUFJLENBQUM7QUFEL0M7QUFEUCxhQUdPLFNBQVMsQ0FBQyxLQUhqQjt1QkFJSSxPQUFRLENBQUEsTUFBTyxDQUFBLENBQUEsQ0FBUCxHQUFZLFVBQVosQ0FBd0IsQ0FBQSxNQUFPLENBQUEsQ0FBQSxDQUFQLEdBQVksTUFBWixDQUFoQyxHQUFzRCxJQUFJLENBQUM7QUFEeEQ7QUFIUCxhQUtPLFNBQVMsQ0FBQyxJQUxqQjt1QkFNSSxPQUFRLENBQUEsTUFBTyxDQUFBLENBQUEsQ0FBUCxHQUFZLEtBQVosQ0FBbUIsQ0FBQSxNQUFPLENBQUEsQ0FBQSxDQUFQLEdBQVksVUFBWixDQUEzQixHQUFxRCxJQUFJLENBQUM7QUFEdkQ7QUFMUCxhQU9PLFNBQVMsQ0FBQyxJQVBqQjt1QkFRSSxPQUFRLENBQUEsTUFBTyxDQUFBLENBQUEsQ0FBUCxDQUFXLENBQUEsTUFBTyxDQUFBLENBQUEsQ0FBUCxHQUFZLFVBQVosQ0FBbkIsR0FBNkMsSUFBSSxDQUFDO0FBRC9DO0FBUFA7O0FBQUE7QUFGRjs7RUFuQlU7Ozs7OztBQWlDZCxJQUFJLENBQUMsU0FBTCxHQUFpQjs7QUFDakIsSUFBSSxDQUFDLElBQUwsR0FBWTs7QUFDWixJQUFJLENBQUMsS0FBTCxHQUFhOztBQUNiLElBQUksQ0FBQyxHQUFMLEdBQVkiLCJmaWxlIjoibW9kZWwvbWFwLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuIyAgVGhpcyBmaWxlIGNvbnRhaW5zIHNvbWUgY2xhc3NlcyBhbmQgdXRpbGl0aWVzIHRvIHdvcmsgd2l0aCByb29tcyBhbmQgbWFwc1xyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4jICBBdXRob3I6IEFkcmlhbiBNb3Jlbm9cclxuIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcblRpbGUgPVxyXG4gIEVNUFRZICAgIDogMFxyXG4gIE9DQ1VQSUVEIDogMVxyXG4gIEdST1VORDogMVxyXG4gIFdBTEw6IC0xXHJcbiAgRE9PUjogLTJcclxuICBGSVJTVF9ST09NOiAyXHJcbiAgVFJFQVNVUkVfUk9PTTogM1xyXG4gIFNFQ1JFVF9ST09NOiA0XHJcblxyXG5EaXJlY3Rpb24gPVxyXG4gIE5PUlRIIDogMFxyXG4gIEVBU1QgIDogMVxyXG4gIFNPVVRIIDogMlxyXG4gIFdFU1QgIDogM1xyXG5cclxuXHJcbiMjI1xyXG4gIFRoaXMgY2xhc3MgcmVwcmVzZW50cyBhIHJvb20gaW4gdGhlIG1hcC4gVGhlIHJvbSBpcyBkZWZpbmVkIGJ5IGEgcG9pbnQgaW4gYVxyXG4gIDJEIHNwYWNlIChyZXByZXNlbnRpbmcgaXRzIHVwcGVyLWxlZnQgY29ybmVyKSwgaXRzIHdpZHRoIGFuZCBpdHMgaGVpZ2h0LiBJdFxyXG4gIGlzIGFsc28gbGlua2VkIHRvIGl0cyBuZWlnaGJvdXJzLCBzbyBpdCBjYW4gYmUgdHJlYXRlZCBhcyBhIG5vZGUgaW4gYSBncmFwaC5cclxuIyMjXHJcblxyXG5jbGFzcyBSb29tWFxyXG5cclxuICBjb25zdHJ1Y3RvcjogKHgsIHksIHdpZHRoLCBoZWlnaHQsIG5laWdoYm91cnMsIGlkLCBzcGVjaWFsLCBzdGF0ZSA9ICdvcGVuJykgLT5cclxuICAgIHRoaXMub3JpZ2luID0gbmV3IFBvaW50KHgsIHkpXHJcbiAgICB0aGlzLnAyID0gbmV3IFBvaW50KHggKyB3aWR0aCAtIDEsIHkgKyBoZWlnaHQgLSAxKVxyXG4gICAgdGhpcy54ID0gb3JpZ2luLnhcclxuICAgIHRoaXMueSA9IG9yaWdpbi55XHJcbiAgICB0aGlzLnN0YXRlID0gJ29wZW4nXHJcbiAgICB0aGlzLnNwZWNpYWwgPSBzcGVjaWFsXHJcbiAgICB0aGlzLndpZHRoID0gd2lkdGhcclxuICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0XHJcbiAgICB0aGlzLmlkID0gaWRcclxuICAgICMgSWYgbm8gbmVpZ2hib3VycyBhcmUgcHJvdmlkZWQsIGluaXRpYWxpemUgdGhlIGFycmF5IHdpdGggbnVsbCBvYmplY3RzXHJcbiAgICB0aGlzLm5laWdoYm91cnMgPSBuZWlnaGJvdXJzID8gKCBudWxsIGZvciBpIGluIFswLi4uOF0gKVxyXG5cclxuICBnZXRFeGl0czogKCkgLT5cclxuICAgIFtdLnB1c2goXHJcbiAgICAgIChmb3IgaSBpbiBbMC4uLnRoaXMud2lkdGhdXHJcbiAgICAgICAgKERpcmVjdGlvbi5OT1JUSCArIChpKjQpOyBEaXJlY3Rpb24uU09VVEggKyAoaSo0KSkpLFxyXG4gICAgICAoZm9yIGkgaW4gWzAuLnRoaXMuaGVpZ2h0XVxyXG4gICAgICAgIChEaXJlY3Rpb24uRUFTVCArIChpKjQpOyBEaXJlY3Rpb24uV0VTVCArIChpKjQpKSlcclxuICAgIClcclxuXHJcbiAgaGFzRXhpdDogKGV4aXQpIC0+XHJcbiAgICAoKGV4aXQgJSA0IGlzIERpcmVjdGlvbi5OT1JUSCBvciBleGl0ICUgNCBpcyBEaXJlY3Rpb24uU09VVEgpIGFuZFxyXG4gICAgICBleGl0IC8vIDQgPCB0aGlzLndpZHRoKSBvclxyXG4gICAgKChleGl0ICUgNCBpcyBEaXJlY3Rpb24uRUFTVCBvciBleGl0ICUgNCBpcyBEaXJlY3Rpb24uV0VTVCkgYW5kXHJcbiAgICAgIGV4aXQgLy8gNCA8IHRoaXMuaGVpZ2h0KVxyXG5cclxuICBnZXRBdmFpbGFibGVFeGl0czogKCkgLT5cclxuICAgICMgUmV0dXJuIGFuIGFycmF5IHdpdGggdGhlIGluZGV4ZXMgb2YgdW51c2VkIGV4aXRzIG9mIHRoZSByb29tXHJcbiAgICBkb29yIGZvciBuZWlnaGJvdXIsIGRvb3IgaW4gdGhpcy5uZWlnaGJvdXJzIHdoZW4gdGhpcy5oYXNFeGl0KGRvb3IpIGFuZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdCBuZWlnaGJvdXI/XHJcblxyXG4gIGNsb25lOiAoKSAtPiBuZXcgUm9vbShcclxuICAgICAgQG9yaWdpblswXSwgQG9yaWdpblsxXSwgQHdpZHRoLCBAaGVpZ2h0LCAobiBmb3IgbiBpbiB0aGlzLm5laWdoYm91cnMpLFxyXG4gICAgICBAaWQsIEBzcGVjaWFsLCBAc3RhdGVcclxuICAgIClcclxuXHJcbiAgaXNDb250YWluZWRJbjogKGFycmF5KSAtPlxyXG4gICAgZm9yIGl0ZW0gaW4gYXJyYXlcclxuICAgICAgcmV0dXJuIHRydWUgaWYgaXRlbS5vcmlnaW5bMF0gaXMgdGhpcy5vcmlnaW5bMF0gYW5kXHJcbiAgICAgICAgICAgICAgICAgICAgIGl0ZW0ub3JpZ2luWzFdIGlzIHRoaXMub3JpZ2luWzFdIGFuZFxyXG4gICAgICAgICAgICAgICAgICAgICBpdGVtLndpZHRoIGlzIHRoaXMud2lkdGggYW5kIGl0ZW0uaGVpZ2h0IGlzIHRoaXMuaGVpZ2h0XHJcbiAgICByZXR1cm4gZmFsc2VcclxuXHJcblxyXG4jIyNcclxuICBUaGlzIGNsYXNzIHJlcHJlc2VudHMgdGhlIGhvbGUgbWFwLiBJdCBpcyBkZWZpbmVkIGJ5IGEgaGVpZ2h0LCBhIHdpZHRoIGFuZFxyXG4gIGEgbGlzdCBvZiByb29tcy5cclxuIyMjXHJcblxyXG5jbGFzcyBNYXBcclxuXHJcbiAgY29uc3RydWN0b3I6IChAd2lkdGgsIEBoZWlnaHQsIEByb29tTGlzdCkgLT5cclxuXHJcbiAgZ2V0VGlsZW1hcDogKHRpbGVzUGVyVW5pdCkgLT5cclxuICAgIHRpbGVzUGVyVW5pdCsrICAjIExlYXZlIHNwYWNlIGZvciB3YWxsc1xyXG4gICAgdGlsZW1hcCA9IG5ldyBUaWxlbWFwKFxyXG4gICAgICAodGhpcy53aWR0aCAqIHRpbGVzUGVyVW5pdCkgKyAxLFxyXG4gICAgICAodGhpcy5oZWlnaHQgKiB0aWxlc1BlclVuaXQpICsgMSxcclxuICAgICAgVGlsZS5FTVBUWVxyXG4gICAgKVxyXG4gICAgcGFpbnRSb29tKHJvb20sIHRpbGVtYXAsIHRpbGVzUGVyVW5pdCkgZm9yIHJvb20sIGkgaW4gdGhpcy5yb29tTGlzdFxyXG4gICAgcmV0dXJuIHRpbGVtYXBcclxuXHJcbiAgIyBQcml2YXRlIGhlbHBlclxyXG4gIHBhaW50Um9vbSA9IChyb29tLCB0aWxlbWFwLCB0aWxlc1BlclVuaXQpIC0+XHJcbiAgICAjIENvbnZlcnQgZGltZW5zaW9ucyBhbmQgY29vcmRpbmF0ZXNcclxuICAgIG9yaWdpbiA9IG5ldyBQb2ludChyb29tLngqdGlsZXNQZXJVbml0LCByb29tLnkqdGlsZXNQZXJVbml0KVxyXG4gICAgd2lkdGggPSByb29tLndpZHRoICogdGlsZXNQZXJVbml0XHJcbiAgICBoZWlnaHQgPSByb29tLmhlaWdodCAqIHRpbGVzUGVyVW5pdFxyXG4gICAgIyBQYWludCBmbG9vclxyXG4gICAgaWYgcm9vbS5zcGVjaWFsIGlzICdmaXJzdCByb29tJ1xyXG4gICAgICB0aWxlbWFwLnNldChvcmlnaW5bMF0gKyAxLCBvcmlnaW5bMV0gKyAxLCB3aWR0aCwgaGVpZ2h0LCBUaWxlLkZJUlNUX1JPT00pXHJcbiAgICBlbHNlIGlmIHJvb20uc3BlY2lhbCBpcyAndHJlYXN1cmUgcm9vbSdcclxuICAgICAgdGlsZW1hcC5zZXQob3JpZ2luWzBdICsgMSwgb3JpZ2luWzFdICsgMSwgd2lkdGgsIGhlaWdodCwgVGlsZS5UUkVBU1VSRV9ST09NKVxyXG4gICAgZWxzZSBpZiByb29tLnNwZWNpYWwgaXMgJ3NlY3JldCByb29tJ1xyXG4gICAgICB0aWxlbWFwLnNldChvcmlnaW5bMF0gKyAxLCBvcmlnaW5bMV0gKyAxLCB3aWR0aCwgaGVpZ2h0LCBUaWxlLlNFQ1JFVF9ST09NKVxyXG4gICAgZWxzZSB0aWxlbWFwLnNldChvcmlnaW5bMF0gKyAxLCBvcmlnaW5bMV0gKyAxLCB3aWR0aCwgaGVpZ2h0LCBUaWxlLkdST1VORClcclxuICAgICMgUGFpbnQgd2FsbHNcclxuICAgIHRpbGVtYXAuc2V0KG9yaWdpblswXSwgb3JpZ2luWzFdLCB3aWR0aCArIDEsIDEsIFRpbGUuV0FMTCkgICAgICAgICAgIyBOb3J0aFxyXG4gICAgdGlsZW1hcC5zZXQob3JpZ2luWzBdLCBvcmlnaW5bMV0gKyBoZWlnaHQsIHdpZHRoICsgMSwgMSwgVGlsZS5XQUxMKSAjIFNvdXRoXHJcbiAgICB0aWxlbWFwLnNldChvcmlnaW5bMF0gKyB3aWR0aCwgb3JpZ2luWzFdLCAxLCBoZWlnaHQgKyAxLCBUaWxlLldBTEwpICMgRWFzdFxyXG4gICAgdGlsZW1hcC5zZXQob3JpZ2luWzBdLCBvcmlnaW5bMV0sIDEsIGhlaWdodCArIDEsIFRpbGUuV0FMTCkgICAgICAgICAjIFdlc3RcclxuICAgICMgUGFpbnQgZG9vcnNcclxuICAgIGZvciBuZWlnaGJvdXIsIGRvb3IgaW4gcm9vbS5uZWlnaGJvdXJzIHdoZW4gbmVpZ2hib3VyP1xyXG4gICAgICBkb29yT2Zmc2V0ID0gKChkb29yIC8vIDQpICogdGlsZXNQZXJVbml0KSArICh0aWxlc1BlclVuaXQgLy8gMilcclxuICAgICAgc3dpdGNoIChkb29yICUgNClcclxuICAgICAgICB3aGVuIERpcmVjdGlvbi5OT1JUSFxyXG4gICAgICAgICAgdGlsZW1hcFtvcmlnaW5bMF0gKyBkb29yT2Zmc2V0XVtvcmlnaW5bMV1dID0gVGlsZS5ET09SXHJcbiAgICAgICAgd2hlbiBEaXJlY3Rpb24uU09VVEhcclxuICAgICAgICAgIHRpbGVtYXBbb3JpZ2luWzBdICsgZG9vck9mZnNldF1bb3JpZ2luWzFdICsgaGVpZ2h0XSA9IFRpbGUuRE9PUlxyXG4gICAgICAgIHdoZW4gRGlyZWN0aW9uLkVBU1RcclxuICAgICAgICAgIHRpbGVtYXBbb3JpZ2luWzBdICsgd2lkdGhdW29yaWdpblsxXSArIGRvb3JPZmZzZXRdID0gVGlsZS5ET09SXHJcbiAgICAgICAgd2hlbiBEaXJlY3Rpb24uV0VTVFxyXG4gICAgICAgICAgdGlsZW1hcFtvcmlnaW5bMF1dW29yaWdpblsxXSArIGRvb3JPZmZzZXRdID0gVGlsZS5ET09SXHJcblxyXG5cclxuIyBNYWtlIGVsZW1lbnRzIGF2YWlsYWJsZSBnbG9iYWxseVxyXG50aGlzLkRpcmVjdGlvbiA9IERpcmVjdGlvblxyXG50aGlzLlRpbGUgPSBUaWxlXHJcbnRoaXMuUm9vbVggPSBSb29tXHJcbnRoaXMuTWFwICA9IE1hcFxyXG4iXX0=