var CanvasController,Color,wall;Color={GRID:"#211",BACKGROUND:"#fff",WALL:"#200",GROUND:"#622",DOOR:"#844",START_POINT:"#450"},wall=["NONE","TILE","COMPOSED"],CanvasController=function(){function t(t){this.id=t,this.canvas=$("#"+this.id)[0].getContext("2d")}return t.prototype.getWidth=function(){return parseInt($("#"+this.id).attr("width"))},t.prototype.calculateTileSize=function(t){return Math.floor(this.getWidth()/t)},t.prototype.calculateGridWidth=function(t){return Math.floor(t/10)},t.prototype.calculateWallSize=function(t){return Math.floor(t/3)},t.prototype.drawMap=function(t,i,l){var e,a,s,h,o,r,n;for(null==i&&(i=!0),null==l&&(l=1),o=this.calculateTileSize(t.width),this.canvas.fillStyle=Color.BACKGROUND,this.canvas.fillRect(0,0,this.getWidth(),this.getWidth()),n=e=0,s=t.height;s>=0?s>e:e>s;n=s>=0?++e:--e)for(r=a=0,h=t.width;h>=0?h>a:a>h;r=h>=0?++a:--a)switch(t[r][n]){case Tile.GROUND:this.drawTile(r,n,o,Color.GROUND);break;case Tile.WALL:"TILE"===wall[l]?this.drawTile(r,n,o,Color.WALL):"COMPOSED"===wall[l]&&this.drawWall(r,n,o,Color.WALL,t);break;case Tile.DOOR:this.drawTile(r,n,o,Color.DOOR)}return i?this.drawGrid(t):void 0},t.prototype.drawTile=function(t,i,l,e){return this.canvas.fillStyle=e,this.canvas.fillRect(t*l,i*l,l,l)},t.prototype.drawWall=function(t,i,l,e,a){var s,h;return s={north:!a.is(t,i-1,1,1,Tile.EMPTY)&&!a.is(t,i-1,1,1,Tile.WALL)&&i>1,south:!a.is(t,i+1,1,1,Tile.EMPTY)&&!a.is(t,i+1,1,1,Tile.WALL)&&i<a.height-1,east:!a.is(t+1,i,1,1,Tile.EMPTY)&&!a.is(t+1,i,1,1,Tile.WALL)&&t<a.width-1,west:!a.is(t-1,i,1,1,Tile.EMPTY)&&!a.is(t-1,i,1,1,Tile.WALL)&&t>1,northwest:!a.is(t-1,i-1,1,1,Tile.EMPTY)&&!a.is(t-1,i-1,1,1,Tile.WALL)&&i>1&&t>1,northeast:!a.is(t+1,i-1,1,1,Tile.EMPTY)&&!a.is(t+1,i-1,1,1,Tile.WALL)&&i>1&&t<a.width-1,southwest:!a.is(t-1,i+1,1,1,Tile.EMPTY)&&!a.is(t-1,i+1,1,1,Tile.WALL)&&i<a.height-1&&t>1,southeast:!a.is(t+1,i+1,1,1,Tile.EMPTY)&&!a.is(t+1,i+1,1,1,Tile.WALL)&&i<a.height-1&&t<a.width-1},h=this.calculateWallSize(l),this.canvas.fillStyle=e,s.north&&this.canvas.fillRect(t*l,i*l,l,h),s.south&&this.canvas.fillRect(t*l,(i+1)*l-h,l,h),s.east&&this.canvas.fillRect((t+1)*l-h,i*l,h,l),s.west&&this.canvas.fillRect(t*l,i*l,h,l),s.northwest&&this.canvas.fillRect(t*l,i*l,h,h),s.northeast&&this.canvas.fillRect((t+1)*l-h,i*l,h,h),s.southeast&&this.canvas.fillRect((t+1)*l-h,(i+1)*l-h,h,h),s.southwest?this.canvas.fillRect(t*l,(i+1)*l-h,h,h):void 0},t.prototype.drawGrid=function(t){var i,l,e,a;for(e=this.calculateTileSize(t.width),this.canvas.beginPath(),this.canvas.strokeStyle=Color.GRID,a=i=0,l=t.width;l>=0?l>=i:i>=l;a=l>=0?++i:--i)this.canvas.moveTo(a*e,0),this.canvas.lineTo(a*e,t.width*e),this.canvas.moveTo(0,a*e),this.canvas.lineTo(t.width*e,a*e);return this.canvas.lineWidth=this.calculateGridWidth(e),this.canvas.stroke(),this.canvas.closePath()},t}(),this.CanvasController=CanvasController,this.wallStyle=wall;